<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">AI推 - 实时AI新闻推送系统</title>
    
    <!-- 基础Meta标签 -->
    <meta name="description" id="page-description" content="专业的AI新闻资讯平台，实时推送人工智能科技新闻">
    <meta name="keywords" id="page-keywords" content="AI,人工智能,新闻,资讯,科技">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" id="og-url" content="https://news.aipush.fun/">
    <meta property="og:title" id="og-title" content="AI推 - 实时AI新闻推送系统">
    <meta property="og:description" id="og-description" content="专业的AI新闻资讯平台，实时推送人工智能科技新闻">
    <meta property="og:image" id="og-image" content="https://news.aipush.fun/wechat-share-300.png">
    <meta property="og:image:secure_url" id="og-image-secure" content="https://news.aipush.fun/wechat-share-300.png">
    <meta property="og:image:width" content="300">
    <meta property="og:image:height" content="300">
    <meta property="og:image:type" content="image/png">
    <meta property="og:site_name" content="AI推">
    <meta property="og:locale" content="zh_CN">
    
    <!-- 微信专用标签 -->
    <meta name="wechat:title" id="wechat-title" content="AI推 - 实时AI新闻推送系统">
    <meta name="wechat:desc" id="wechat-desc" content="专业的AI新闻资讯平台，实时推送人工智能科技新闻">
    <meta name="wechat:image" id="wechat-image" content="https://news.aipush.fun/wechat-share-300.png">
    <meta name="wxcard:title" id="wxcard-title" content="AI推 - 实时AI新闻推送系统">
    <meta name="wxcard:desc" id="wxcard-desc" content="专业的AI新闻资讯平台，实时推送人工智能科技新闻">
    <meta name="wxcard:imgUrl" id="wxcard-image" content="https://news.aipush.fun/wechat-share-300.png">
    <meta name="wxcard:link" id="wxcard-link" content="https://news.aipush.fun/">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" id="twitter-title" content="AI推 - 实时AI新闻推送系统">
    <meta name="twitter:description" id="twitter-description" content="专业的AI新闻资讯平台，实时推送人工智能科技新闻">
    <meta name="twitter:image" id="twitter-image" content="https://news.aipush.fun/wechat-share-300.png">
    
    <!-- 微信环境优化 -->
    <meta name="format-detection" content="telephone=no">
    <meta name="x5-orientation" content="portrait">
    <meta name="x5-fullscreen" content="true">
    
    <style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
        color: #333;
        line-height: 1.6;
    }
    .container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .loading {
        text-align: center;
        color: #666;
        margin: 20px 0;
    }
    .title {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 10px;
        line-height: 1.4;
    }
    .description {
        color: #666;
        line-height: 1.6;
        margin-bottom: 20px;
    }
    .meta {
        font-size: 12px;
        color: #999;
        border-top: 1px solid #eee;
        padding-top: 10px;
    }
    .spinner {
        border: 2px solid #f3f3f3;
        border-top: 2px solid #3498db;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
        display: inline-block;
        margin-right: 10px;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .error {
        color: #e74c3c;
        text-align: center;
        margin: 20px 0;
    }
    .retry-btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="title" id="content-title">AI推 - 实时AI新闻推送系统</div>
        <div class="description" id="content-description">专业的AI新闻资讯平台，实时推送人工智能科技新闻</div>
        <div class="loading" id="loading-status">
            <div class="spinner"></div>
            正在加载新闻内容...
        </div>
        <div class="meta">来源：AI推 | 发布时间：<span id="publish-time"></span></div>
    </div>

    <script>
    // 微信分享代理页面脚本
    (function() {
        const isWeChat = /micromessenger/i.test(navigator.userAgent);
        
        // 从URL参数中获取新闻信息
        const urlParams = new URLSearchParams(window.location.search);
        const newsId = urlParams.get('id') || urlParams.get('newsId');
        const title = urlParams.get('title');
        const desc = urlParams.get('desc');
        const image = urlParams.get('image');
        const targetUrl = urlParams.get('url');

        console.log('微信分享代理页面参数:', { newsId, title, desc, image, targetUrl });

        // 如果有直接传入的参数，立即更新Meta标签
        if (title || desc || image) {
            updateMetaTags({
                title: title || 'AI推 - 实时AI新闻推送系统',
                desc: desc || '专业的AI新闻资讯平台，实时推送人工智能科技新闻',
                image: image || 'https://news.aipush.fun/wechat-share-300.png',
                url: targetUrl || window.location.href
            });
        }

        // 如果有新闻ID，尝试获取详细信息
        if (newsId) {
            loadNewsData(newsId);
        } else {
            // 没有新闻ID，延迟跳转到主页
            setTimeout(() => {
                window.location.href = targetUrl || 'https://news.aipush.fun/';
            }, 2000);
        }

        /**
         * 加载新闻数据
         */
        async function loadNewsData(newsId) {
            try {
                const response = await fetch(`/news-data.json?t=${Date.now()}`);
                const data = await response.json();
                const allNews = data.data || data;
                const news = allNews.find(item => item.id === newsId);

                if (news) {
                    updateMetaTags({
                        title: news.title,
                        desc: news.summary || news.content?.substring(0, 200) || '来自AI推的最新资讯',
                        image: news.imageUrl || 'https://news.aipush.fun/wechat-share-300.png',
                        url: `https://news.aipush.fun/#/news/${newsId}`
                    });

                    updatePageContent(news);
                    
                    // 延迟跳转到实际页面
                    setTimeout(() => {
                        window.location.href = `https://news.aipush.fun/#/news/${newsId}`;
                    }, isWeChat ? 3000 : 1000);
                } else {
                    showError('新闻不存在');
                }
            } catch (error) {
                console.error('加载新闻数据失败:', error);
                showError('加载失败，即将跳转到主页');
                setTimeout(() => {
                    window.location.href = 'https://news.aipush.fun/';
                }, 2000);
            }
        }

        /**
         * 更新Meta标签
         */
        function updateMetaTags(data) {
            // 更新页面标题
            document.title = data.title + ' - AI推';
            
            // 更新所有相关的Meta标签
            const metaUpdates = [
                { id: 'page-title', content: data.title },
                { id: 'page-description', content: data.desc },
                { id: 'og-title', content: data.title },
                { id: 'og-description', content: data.desc },
                { id: 'og-image', content: data.image },
                { id: 'og-image-secure', content: data.image },
                { id: 'og-url', content: data.url },
                { id: 'wechat-title', content: data.title },
                { id: 'wechat-desc', content: data.desc },
                { id: 'wechat-image', content: data.image },
                { id: 'wxcard-title', content: data.title },
                { id: 'wxcard-desc', content: data.desc },
                { id: 'wxcard-image', content: data.image },
                { id: 'wxcard-link', content: data.url },
                { id: 'twitter-title', content: data.title },
                { id: 'twitter-description', content: data.desc },
                { id: 'twitter-image', content: data.image }
            ];

            metaUpdates.forEach(update => {
                const element = document.getElementById(update.id);
                if (element) {
                    element.setAttribute('content', update.content);
                }
            });

            console.log('Meta标签更新完成:', data);
        }

        /**
         * 更新页面内容
         */
        function updatePageContent(news) {
            document.getElementById('content-title').textContent = news.title;
            document.getElementById('content-description').textContent = 
                news.summary || news.content?.substring(0, 200) || '来自AI推的最新资讯';
            document.getElementById('publish-time').textContent = 
                new Date(news.publishedAt).toLocaleString('zh-CN');
            document.getElementById('loading-status').innerHTML = 
                '<div class="spinner"></div>即将跳转到完整页面...';
        }

        /**
         * 显示错误信息
         */
        function showError(message) {
            document.getElementById('loading-status').innerHTML = 
                `<div class="error">${message}</div>`;
        }
    })();
    </script>
</body>
</html>
