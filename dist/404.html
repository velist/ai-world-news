<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI推 - 正在跳转...</title>
  <meta name="description" content="正在为您跳转到AI推新闻页面..." />
  
  <!-- 微信环境优化 -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  
  <script>
    /**
     * 检测微信浏览器
     */
    function isWeChatBrowser() {
      return /micromessenger/i.test(navigator.userAgent);
    }
    
    /**
     * 检测是否为新闻详情路径
     */
    function isNewsDetailPath(path) {
      return /^\/news\/[^\/]+$/.test(path);
    }
    
    /**
     * 从路径中提取新闻ID
     */
    function extractNewsIdFromPath(path) {
      var match = path.match(/^\/news\/([^\/]+)$/);
      return match ? match[1] : null;
    }
    
    /**
     * 混合路由重定向处理
     */
    function handleHybridRedirect() {
      var l = window.location;
      console.log('404页面加载，当前URL:', l.href);
      console.log('是否微信环境:', isWeChatBrowser());
      
      var path = l.pathname;
      var search = l.search;
      var hash = l.hash;
      
      // 检查是否为新闻详情页路径
      var newsId = extractNewsIdFromPath(path);
      
      if (isWeChatBrowser()) {
        // 微信环境 - 使用Hash路由
        if (newsId) {
          console.log('微信环境检测到新闻路径，新闻ID:', newsId);
          var targetUrl = '/#/news/' + newsId;
          console.log('跳转到Hash URL:', targetUrl);
          setTimeout(function() {
            window.location.replace(targetUrl);
          }, 100);
        } else if (path !== '/' && path !== '/index.html') {
          console.log('微信环境检测到其他路径，使用Hash路由:', path);
          var targetUrl = '/#' + path + search + hash;
          console.log('跳转到Hash URL:', targetUrl);
          setTimeout(function() {
            window.location.replace(targetUrl);
          }, 100);
        } else {
          console.log('微信环境首页，直接加载应用');
          setTimeout(function() {
            window.location.replace('/');
          }, 100);
        }
      } else {
        // 普通环境 - 使用标准重定向
        if (path !== '/' && path !== '/index.html') {
          console.log('普通环境重定向到index.html');
          var targetUrl = '/index.html?path=' + encodeURIComponent(path + search + hash);
          console.log('跳转到:', targetUrl);
          setTimeout(function() {
            window.location.replace(targetUrl);
          }, 100);
        } else {
          console.log('普通环境首页，直接加载应用');
          setTimeout(function() {
            window.location.replace('/');
          }, 100);
        }
      }
    }
    
    // 执行重定向
    handleHybridRedirect();
  </script>
</head>
<body>
  <div style="text-align: center; padding: 50px; font-family: Arial, sans-serif;">
    <h2>🔄 正在跳转...</h2>
    <p>正在为您跳转到AI推新闻页面</p>
    <p><small>如果页面没有自动跳转，请<a href="/" style="color: #0066cc;">点击这里</a></small></p>
    <div id="debug-info" style="display: none; margin-top: 20px; font-size: 12px; color: #666;">
      <p>调试信息：</p>
      <p id="current-url"></p>
      <p id="browser-type"></p>
      <p id="redirect-target"></p>
    </div>
  </div>
  
  <script>
    // 显示调试信息（仅在开发环境）
    if (window.location.search.includes('debug=true')) {
      document.getElementById('debug-info').style.display = 'block';
      document.getElementById('current-url').textContent = '当前URL: ' + window.location.href;
      document.getElementById('browser-type').textContent = '浏览器类型: ' + (isWeChatBrowser() ? '微信浏览器' : '普通浏览器');
    }
    
    // 备用跳转机制 - 增强版
    setTimeout(function() {
      var currentPath = window.location.pathname;
      var currentHash = window.location.hash;
      var isWeChat = isWeChatBrowser();
      var isNewsPath = isNewsDetailPath(currentPath);
      
      console.log('备用跳转检查:', { currentPath, currentHash, isWeChat, isNewsPath });
      
      // 如果仍然在404页面且没有进行Hash跳转
      if (currentPath !== '/' && currentPath !== '/index.html' && !currentHash) {
        if (isWeChat) {
          console.log('微信环境备用跳转');
          if (isNewsPath) {
            var newsId = extractNewsIdFromPath(currentPath);
            window.location.replace('/#/news/' + newsId);
          } else {
            window.location.replace('/#' + currentPath);
          }
        } else {
          console.log('普通环境备用跳转');
          window.location.replace('/');
        }
      }
    }, 3000);
    
    // 最终备用跳转
    setTimeout(function() {
      if (window.location.pathname !== '/' && !window.location.hash) {
        console.log('最终备用跳转到首页');
        window.location.replace('/');
      }
    }, 5000);
  </script>
</body>
</html>