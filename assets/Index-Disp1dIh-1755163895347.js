var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{j as s}from"./ui-core-BKA7Vtug-1755163895347.js";import{r as a}from"./react-vendor-BrSRjOqW-1755163895347.js";import{u as i,c as n,_ as r,g as o,H as c}from"./index-CTaQ5PiN-1755163895347.js";import{L as l,M as d,S as h,G as m,U as u,a as g,E as p,C as x,X as f,b as y,H as w,B as b,I as v,c as j,d as C,N,F as A,e as S,f as I,g as k,h as T,i as P,j as R,R as E}from"./vendor-misc-CaELhG2U-1755163895347.js";import{L as D,T as F,C as M,R as $}from"./ui-extended-D6e9s9Dh-1755163895347.js";import{C as z,a as L,B as Q,b as O}from"./badge-CenQvFbu-1755163895347.js";import{B as q}from"./button-CHC1L-IQ-1755163895347.js";import{u as G}from"./useNewsTranslation-CnGRmyYZ-1755163895347.js";import{L as U,u as B}from"./router-BeLUERiu-1755163895347.js";import"./utils-DdJ5UvfL-1755163895347.js";import"./query-S920TqVI-1755163895347.js";const _=()=>{const{language:e,toggleLanguage:t}=i();return s.jsxs("button",{onClick:t,className:"flex items-center space-x-1.5 px-3 py-1.5 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-full text-white transition-all duration-200 group",title:"zh"===e?"Switch to English":"切换到中文",children:[s.jsx(l,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm font-medium",children:"zh"===e?"EN":"中"})]})},H=({onMenuClick:e})=>{const[t,n]=a.useState(!1),{isZh:r}=i();return s.jsxs("div",{className:"relative overflow-hidden bg-gradient-hero rounded-b-3xl shadow-large",children:[s.jsx("div",{className:"absolute inset-0 bg-black/10"}),s.jsx("div",{className:"absolute top-4 left-4 z-10",children:s.jsx("button",{onClick:e,className:"flex items-center space-x-1.5 px-3 py-1.5 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-full text-white transition-all duration-200 group",children:s.jsx(d,{className:"w-4 h-4"})})}),s.jsx("div",{className:"absolute top-4 right-4 z-10",children:s.jsx(_,{})}),s.jsxs("div",{className:"relative px-4 py-8 text-center text-white",children:[s.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[s.jsx(h,{className:"w-6 h-6"}),s.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:r?"实时AI新闻推送系统":"Real-time AI News System"})]}),s.jsxs("div",{className:"flex items-center justify-center space-x-2 opacity-90 mb-3",children:[s.jsx(m,{className:"w-4 h-4"}),s.jsx("p",{className:"text-sm md:text-base",children:r?"国际新闻推送 · AI翻译 · AI点评":"Global News · AI Translation · AI Analysis"})]}),s.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[s.jsx(u,{className:"w-4 h-4"}),s.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText("forxy9"),n(!0),setTimeout(()=>n(!1),3e3)}catch(e){const t=document.createElement("input");t.value="forxy9",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),n(!0),setTimeout(()=>n(!1),3e3)}},className:"text-sm hover:text-blue-200 transition-colors underline decoration-dotted underline-offset-2",children:r?"点击加入AI交流社群，一起成长":"Join AI Community for Growth"})]}),t&&s.jsx("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-in fade-in slide-in-from-top-2",children:r?"复制成功，打开微信搜索！":"Copied! Search in WeChat!"}),s.jsx("div",{className:"absolute top-8 right-8 w-1 h-1 bg-white/40 rounded-full animate-pulse delay-300"}),s.jsx("div",{className:"absolute bottom-6 right-8 w-1 h-1 bg-white/50 rounded-full animate-pulse delay-700"})]})]})},W=$,J=a.forwardRef(({className:e,...t},a)=>s.jsx(D,{ref:a,className:n("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));J.displayName=D.displayName;const V=a.forwardRef(({className:e,...t},a)=>s.jsx(F,{ref:a,className:n("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));V.displayName=F.displayName;a.forwardRef(({className:e,...t},a)=>s.jsx(M,{ref:a,className:n("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t})).displayName=M.displayName;const K=({categories:e,activeCategory:t,onCategoryChange:a})=>{const{isZh:n}=i(),r=e=>{switch(e.toLowerCase()){case"全部":default:return"📰";case"ai":case"ai模型":case"ai 模型":return"🤖";case"科技":return"💻";case"经济":return"📈";case"深度分析":return"🔍"}},o=e=>{if(!n)switch(e){case"全部":return"All";case"AI":return"AI";case"科技":return"Tech";case"经济":return"Economy";case"深度分析":return"Analysis";default:return e}return e};return s.jsx("div",{className:"w-full overflow-x-auto",children:s.jsx(W,{value:t,onValueChange:a,children:s.jsx(J,{className:"inline-flex h-auto bg-muted/50 p-1 rounded-xl backdrop-blur-sm border border-border/50",children:e.map(e=>s.jsxs(V,{value:e,className:"flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 data-[state=active]:bg-gradient-primary data-[state=active]:text-white data-[state=active]:shadow-medium whitespace-nowrap",children:[s.jsx("span",{className:"text-base",children:r(e)}),s.jsx("span",{children:o(e)})]},e))})})})},Z=class e{constructor(){t(this,"services",new Map),t(this,"requestQueue",[]),t(this,"activeRequests",new Map),t(this,"cache",new Map),t(this,"healthCheckInterval"),t(this,"AI_SERVICES",[{id:"dalle3",name:"DALL·E 3",endpoint:"/api/ai/dalle3",priority:1,maxConcurrent:3,timeout:3e4,isActive:!0,currentLoad:0,successRate:.95,avgResponseTime:15e3,lastHealthCheck:Date.now()},{id:"midjourney",name:"Midjourney",endpoint:"/api/ai/midjourney",priority:2,maxConcurrent:5,timeout:25e3,isActive:!0,currentLoad:0,successRate:.92,avgResponseTime:12e3,lastHealthCheck:Date.now()},{id:"stable-diffusion",name:"Stable Diffusion",endpoint:"/api/ai/stable-diffusion",priority:3,maxConcurrent:8,timeout:2e4,isActive:!0,currentLoad:0,successRate:.88,avgResponseTime:8e3,lastHealthCheck:Date.now()},{id:"flux",name:"Flux AI",endpoint:"/api/ai/flux",priority:4,maxConcurrent:6,timeout:15e3,isActive:!0,currentLoad:0,successRate:.9,avgResponseTime:1e4,lastHealthCheck:Date.now()},{id:"firefly",name:"Adobe Firefly",endpoint:"/api/ai/firefly",priority:5,maxConcurrent:4,timeout:18e3,isActive:!0,currentLoad:0,successRate:.85,avgResponseTime:14e3,lastHealthCheck:Date.now()}]),this.initializeServices(),this.startHealthChecks(),this.startQueueProcessor()}static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeServices(){this.AI_SERVICES.forEach(e=>{this.services.set(e.id,{...e})})}async generateShareImage(e){Date.now();const t=this.cache.get(e.cacheKey);if(t&&Date.now()-t.generatedAt<36e5)return t;if(this.activeRequests.has(e.cacheKey))return await this.activeRequests.get(e.cacheKey);const s=this.processImageGeneration(e);this.activeRequests.set(e.cacheKey,s);try{const t=await s;return t.success&&this.cache.set(e.cacheKey,t),t}finally{this.activeRequests.delete(e.cacheKey)}}async processImageGeneration(e){const t=this.getAvailableServices();if(0===t.length)return{success:!1,imageUrl:"",generatedAt:Date.now(),serviceId:"none",responseTime:0,quality:0,error:"没有可用的AI服务"};const s=this.selectOptimalServices(t,e.priority).map(t=>this.callAIService(t,e));try{const t=await Promise.race(s);if(t.success)return this.updateServiceMetrics(t.serviceId,!0,t.responseTime),t;const a=(await Promise.allSettled(s)).filter(e=>"fulfilled"===e.status&&e.value.success).map(e=>e.value);if(a.length>0){const e=a.sort((e,t)=>t.quality-e.quality)[0];return this.updateServiceMetrics(e.serviceId,!0,e.responseTime),e}return await this.fallbackGeneration(e)}catch(a){return await this.fallbackGeneration(e)}}selectOptimalServices(e,t){const s="urgent"===t?3:"high"===t?2:1;return e.filter(e=>e.currentLoad<e.maxConcurrent).sort((e,t)=>{const s=.4*e.successRate+1e3/e.avgResponseTime*.3+.03*(10-e.priority);return.4*t.successRate+1e3/t.avgResponseTime*.3+.03*(10-t.priority)-s}).slice(0,s)}async callAIService(e,t){const s=Date.now();e.currentLoad++;try{const a=this.buildPrompt(t),i=await this.makeAIRequest(e,a,t),n=Date.now()-s;return{success:!0,imageUrl:i.imageUrl,base64Data:i.base64Data,generatedAt:Date.now(),serviceId:e.id,responseTime:n,quality:this.assessImageQuality(i),error:void 0}}catch(a){const t=Date.now()-s;return this.updateServiceMetrics(e.id,!1,t),{success:!1,imageUrl:"",generatedAt:Date.now(),serviceId:e.id,responseTime:t,quality:0,error:a instanceof Error?a.message:"未知错误"}}finally{e.currentLoad--}}buildPrompt(e){const{newsData:t,style:s}=e;return`\n创建一个高质量的新闻分享海报：\n标题：${t.title}\n摘要：${t.summary.substring(0,100)}...\n来源：${t.source}\n类别：${t.category}\n\n设计要求：\n- ${{modern:"现代简约风格，扁平化设计，清爽配色",classic:"经典商务风格，专业配色，传统布局",minimal:"极简主义风格，大量留白，突出重点",colorful:"色彩丰富，渐变背景，活力四射"}[s]}\n- 尺寸：750x1334像素，手机分享比例\n- 包含清晰的二维码\n- 品牌标识："AI推 - 智能新闻推送"\n- 字体清晰易读，层次分明\n- 高质量输出，适合社交分享\n\n技术要求：\n- 分辨率300DPI\n- PNG格式\n- 色彩模式RGB\n- 文字抗锯齿\n    `.trim()}async makeAIRequest(e,t,s){const a=e.avgResponseTime+5e3*(Math.random()-.5);if(await new Promise(e=>setTimeout(e,a)),Math.random()>e.successRate)throw new Error(`${e.name}服务暂时不可用`);return{imageUrl:`https://generated-images.cdn.com/${s.cacheKey}-${e.id}.png`,base64Data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg=="}}assessImageQuality(e){let t=80;return e.base64Data&&e.base64Data.length>5e4&&(t+=10),Math.min(t,100)}async fallbackGeneration(e){try{const{posterShareService:t}=await r(async()=>{const{posterShareService:e}=await Promise.resolve().then(()=>ie);return{posterShareService:e}},void 0);return{success:!0,imageUrl:"",base64Data:await t.generateNewsPoster(e.newsData),generatedAt:Date.now(),serviceId:"fallback-canvas",responseTime:2e3,quality:70,error:void 0}}catch(t){return{success:!1,imageUrl:"",generatedAt:Date.now(),serviceId:"fallback-failed",responseTime:0,quality:0,error:"降级方案也失败了"}}}getAvailableServices(){return Array.from(this.services.values()).filter(e=>e.isActive&&e.currentLoad<e.maxConcurrent)}updateServiceMetrics(e,t,s){const a=this.services.get(e);if(!a)return;const i=.1;a.successRate=.9*a.successRate+(t?1:0)*i,t&&(a.avgResponseTime=.9*a.avgResponseTime+s*i)}startHealthChecks(){this.healthCheckInterval=setInterval(async()=>{for(const t of this.services.values())try{const e=await fetch(t.endpoint+"/health",{method:"GET",timeout:5e3});t.isActive=e.ok,t.lastHealthCheck=Date.now()}catch(e){t.isActive=!1}},3e4)}startQueueProcessor(){setInterval(()=>{this.requestQueue.length},1e3)}getServiceStatus(){return Array.from(this.services.values()).map(e=>({id:e.id,name:e.name,isActive:e.isActive,load:e.currentLoad,successRate:e.successRate}))}destroy(){this.healthCheckInterval&&clearInterval(this.healthCheckInterval),this.cache.clear(),this.activeRequests.clear()}};t(Z,"instance");const Y=Z.getInstance(),X=class e{constructor(){t(this,"mcpClients",new Map),this.initializeMCPClients()}static getInstance(){return e.instance||(e.instance=new e),e.instance}async initializeMCPClients(){try{await this.initializeDalle3Client(),await this.initializeMidjourneyClient(),await this.initializeStableDiffusionClient(),await this.initializeFluxClient(),await this.initializeFireflyClient()}catch(e){}}async initializeDalle3Client(){try{const e={name:"dalle3",generateImage:async(e,t)=>{const s={method:"generate_image",params:{prompt:e,size:t.size||"1024x1792",quality:t.quality||"hd",style:t.style||"vivid",response_format:"b64_json"},timeout:3e4};return await this.callMCPService("dalle3",s)}};this.mcpClients.set("dalle3",e)}catch(e){}}async initializeMidjourneyClient(){try{const e={name:"midjourney",generateImage:async(e,t)=>{const s={method:"imagine",params:{prompt:`${e} --ar 9:16 --v 6 --style raw --quality 2`,webhook_url:t.webhook_url,webhook_type:"result"},timeout:25e3};return await this.callMCPService("midjourney",s)}};this.mcpClients.set("midjourney",e)}catch(e){}}async initializeStableDiffusionClient(){try{const e={name:"stable-diffusion",generateImage:async(e,t)=>{const s={method:"txt2img",params:{prompt:e,negative_prompt:"blurry, low quality, distorted, watermark",width:750,height:1334,steps:20,cfg_scale:7.5,sampler_name:"DPM++ 2M Karras",scheduler:"karras",model:"sd_xl_base_1.0.safetensors"},timeout:2e4};return await this.callMCPService("stable-diffusion",s)}};this.mcpClients.set("stable-diffusion",e)}catch(e){}}async initializeFluxClient(){try{const e={name:"flux",generateImage:async(e,t)=>{const s={method:"generate",params:{prompt:e,model:"flux-dev",width:750,height:1334,num_inference_steps:28,guidance_scale:3.5,max_sequence_length:256},timeout:15e3};return await this.callMCPService("flux",s)}};this.mcpClients.set("flux",e)}catch(e){}}async initializeFireflyClient(){try{const e={name:"firefly",generateImage:async(e,t)=>{const s={method:"create_image",params:{prompt:e,contentClass:"photo",size:{width:750,height:1334},visualIntensity:6,style:{strength:20,imageReference:{source:{uploadId:t.referenceImageId}}}},timeout:18e3};return await this.callMCPService("firefly",s)}};this.mcpClients.set("firefly",e)}catch(e){}}async callMCPService(e,t){try{await new Promise(e=>setTimeout(e,2e3*Math.random()+1e3));const s={dalle3:.95,midjourney:.92,"stable-diffusion":.88,flux:.9,firefly:.85};if(Math.random()>(s[e]||.8))throw new Error(`${e}服务暂时不可用`);return{success:!0,data:{imageUrl:`https://mcp-generated.cdn.com/${e}/${Date.now()}.png`,base64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==",metadata:{model:e,generatedAt:(new Date).toISOString(),prompt:t.params.prompt}}}}catch(s){return{success:!1,error:s instanceof Error?s.message:"未知错误"}}}async generateImage(e,t,s={}){const a=this.mcpClients.get(e);if(!a)return{success:!1,error:`服务${e}不可用`};try{return await a.generateImage(t,s)}catch(i){return{success:!1,error:i instanceof Error?i.message:"生成失败"}}}async getServiceHealth(e){try{return(await this.callMCPService(e,{method:"health_check",params:{},timeout:5e3})).success}catch(t){return!1}}getAvailableServices(){return Array.from(this.mcpClients.keys())}};t(X,"instance");const ee=X.getInstance(),te=class e{constructor(){t(this,"canvas"),t(this,"ctx"),t(this,"defaultConfig",{width:750,height:1334,backgroundColor:"#ffffff",brandColor:"#007AFF",textColor:"#1D1D1F",accentColor:"#FF3B30"}),t(this,"appleColors",{blue:"#007AFF",green:"#34C759",orange:"#FF9500",red:"#FF3B30",purple:"#AF52DE",pink:"#FF2D92",yellow:"#FFCC00",teal:"#5AC8FA",indigo:"#5856D6",gray:"#8E8E93",darkGray:"#1D1D1F",lightGray:"#F2F2F7"}),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}static getInstance(){return e.instance||(e.instance=new e),e.instance}async generateNewsPoster(e){const t=this.defaultConfig,s=2*t.width,a=2*t.height;this.canvas.width=s,this.canvas.height=a,this.canvas.style.width=`${t.width}px`,this.canvas.style.height=`${t.height}px`,this.ctx.scale(2,2),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.textRenderingOptimization="optimizeQuality",this.ctx.fillStyle=t.backgroundColor,this.ctx.fillRect(0,0,t.width,t.height);try{await this.drawBackground(),await this.drawBrandHeader(),await this.drawNewsImage(e.imageUrl),await this.drawContentArea(e),await this.drawBottomArea(e.id);return this.canvas.toDataURL("image/png")}catch(i){throw new Error("海报生成失败")}}async drawBackground(){const e=this.ctx.createLinearGradient(0,0,0,this.canvas.height);e.addColorStop(0,this.appleColors.lightGray),e.addColorStop(.5,"#ffffff"),e.addColorStop(1,this.appleColors.lightGray),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}async drawBrandHeader(){const e=.15*this.canvas.height,t=this.ctx.createLinearGradient(0,0,this.canvas.width,0);t.addColorStop(0,this.appleColors.blue),t.addColorStop(.5,this.appleColors.purple),t.addColorStop(1,this.appleColors.pink),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,e),this.ctx.save(),this.ctx.globalCompositeOperation="destination-out",this.ctx.fillStyle="#000000",this.ctx.beginPath(),this.ctx.arc(0,0,20,0,Math.PI/2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(this.canvas.width,0,20,Math.PI/2,Math.PI),this.ctx.fill(),this.ctx.restore();const s=this.canvas.width/2,a=e/2;this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.beginPath(),this.ctx.arc(s,a,30,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle="#ffffff",this.ctx.font='bold 36px -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif',this.ctx.textAlign="center",this.ctx.fillText("AI推",s,a+8),this.ctx.font='16px -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif',this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillText("智能新闻推送",s,a+45)}async drawNewsImage(e){const t=.15*this.canvas.height,s=.45*this.canvas.height,a=this.canvas.width,i=[];e&&(i.push(e),e.startsWith("http")||i.push(`https://news.aipush.fun${e}`)),i.push("/wechat-share-300.png"),i.push("https://news.aipush.fun/wechat-share-300.png");let n=!1;for(const o of i)try{const e=await this.loadImage(o);this.ctx.fillStyle=this.appleColors.lightGray,this.ctx.fillRect(0,t,a,s);const i=Math.max(a/e.width,s/e.height),r=e.width*i,c=e.height*i,l=(a-r)/2,d=(s-c)/2;this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(0,t,a,s),this.ctx.clip(),this.ctx.drawImage(e,0+l,t+d,r,c),this.ctx.restore();const h=this.ctx.createLinearGradient(0,t+s-100,0,t+s);h.addColorStop(0,"rgba(0, 0, 0, 0)"),h.addColorStop(1,"rgba(0, 0, 0, 0.3)"),this.ctx.fillStyle=h,this.ctx.fillRect(0,t,a,s),n=!0;break}catch(r){continue}n||await this.drawImagePlaceholder()}async drawImagePlaceholder(){const e=.15*this.canvas.height,t=.45*this.canvas.height,s=this.canvas.width,a=this.ctx.createLinearGradient(0,e,s,e+t);a.addColorStop(0,"#667eea"),a.addColorStop(.5,"#764ba2"),a.addColorStop(1,"#f093fb"),this.ctx.fillStyle=a,this.ctx.fillRect(0,e,s,t),this.ctx.fillStyle="rgba(255, 255, 255, 0.1)",this.ctx.beginPath(),this.ctx.arc(.8*s,e+.3*t,80,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(.2*s,e+.7*t,40,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.font='bold 48px -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif',this.ctx.textAlign="center",this.ctx.fillText("AI推",this.canvas.width/2,e+t/2-10),this.ctx.font='20px -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif',this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.fillText("智能新闻推送",this.canvas.width/2,e+t/2+30);const i=this.ctx.createLinearGradient(0,e+t-100,0,e+t);i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(1,"rgba(0, 0, 0, 0.3)"),this.ctx.fillStyle=i,this.ctx.fillRect(0,e,s,t)}async drawContentArea(e){const t=.15*this.canvas.height+.45*this.canvas.height,s=.25*this.canvas.height;this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,t,this.canvas.width,s);const a=t+50;this.ctx.fillStyle=this.appleColors.darkGray,this.ctx.font='bold 42px -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif',this.ctx.textAlign="left";const i=this.canvas.width-60,n=this.wrapText(e.title,i,42);n.slice(0,2).forEach((e,t)=>{this.ctx.fillText(e,30,a+52*t)});const r=a+52*Math.min(n.length,2)+30;this.ctx.fillStyle=this.appleColors.gray,this.ctx.font='28px -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif';const o=e.summary.length>100?e.summary.substring(0,100)+"...":e.summary;this.wrapText(o,i,28).slice(0,2).forEach((e,t)=>{this.ctx.fillText(e,30,r+38*t)});const c=t+s-40;this.ctx.fillStyle=this.appleColors.blue,this.ctx.font='22px -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif';const l=new Date(e.publishedAt).toLocaleDateString("zh-CN"),d=`${e.source} • ${e.category} • ${l}`;this.ctx.fillText(d,30,c)}async drawBottomArea(e){const t=.85*this.canvas.height,s=.15*this.canvas.height,a=30;this.ctx.fillStyle=this.appleColors.lightGray,this.ctx.fillRect(0,t,this.canvas.width,s);const i=this.canvas.width-140-a,n=t+(s-140)/2;await this.drawRealQRCode(i,n,140,e),this.ctx.fillStyle=this.appleColors.darkGray,this.ctx.font='bold 28px -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif',this.ctx.textAlign="left",this.ctx.fillText("扫码阅读完整新闻",a,t+50),this.ctx.font='24px -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif',this.ctx.fillStyle=this.appleColors.blue,this.ctx.fillText("news.aipush.fun",a,t+85),this.ctx.fillStyle=this.appleColors.orange,this.ctx.beginPath(),this.ctx.arc(230,t+45,3,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle=this.appleColors.green,this.ctx.beginPath(),this.ctx.arc(250,t+35,2,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle=this.appleColors.pink,this.ctx.beginPath(),this.ctx.arc(270,t+55,2.5,0,2*Math.PI),this.ctx.fill()}async drawRealQRCode(e,t,s,a){try{const n=`${"https://news.aipush.fun"}/#/news/${a}`,r=[{url:`https://www.erweicaihong.cn/api?text=${encodeURIComponent(n)}&size=${s}&key=27e94730-7484-11f0-a569-f7f8300803ea`,name:"彩虹二维码"},{url:`https://api.qrserver.com/v1/create-qr-code/?size=${s}x${s}&data=${encodeURIComponent(n)}&format=png&margin=1&ecc=H&color=000000&bgcolor=ffffff`,name:"QRServer"},{url:`https://quickchart.io/qr?text=${encodeURIComponent(n)}&size=${s}&margin=1&format=png&ecLevel=H`,name:"QuickChart"},{url:`https://qr.liantu.com/api.php?text=${encodeURIComponent(n)}&m=1&e=H&p=1&w=${s}&h=${s}`,name:"联图"},{url:`https://chart.googleapis.com/chart?chs=${s}x${s}&cht=qr&chl=${encodeURIComponent(n)}&choe=UTF-8&chld=H|1`,name:"Google Charts"}];for(const a of r)try{const i=new Image;i.crossOrigin="anonymous";if(await new Promise((n,r)=>{const o=setTimeout(()=>{r(new Error("二维码加载超时"))},8e3);i.onload=()=>{clearTimeout(o),i.width<50||i.height<50?r(new Error("二维码图片尺寸异常")):(this.ctx.fillStyle="#ffffff",this.ctx.fillRect(e-12,t-12,s+24,s+24),this.ctx.imageSmoothingEnabled=!1,this.ctx.drawImage(i,e,t,s,s),this.ctx.strokeStyle="#333333",this.ctx.lineWidth=3,this.ctx.strokeRect(e-6,t-6,s+12,s+12),this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=1,this.ctx.strokeRect(e-1,t-1,s+2,s+2),n(!0))},i.onerror=e=>{clearTimeout(o),r(new Error(`${a.name}图片加载失败: ${e}`))},i.src=a.url}))return}catch(i){continue}this.drawHighQualityQRCodePlaceholder(e,t,s,n)}catch(i){this.drawHighQualityQRCodePlaceholder(e,t,s,`https://news.aipush.fun/#/news/${a}`)}}drawHighQualityQRCodePlaceholder(e,t,s,a){this.ctx.fillStyle="#ffffff",this.ctx.fillRect(e-12,t-12,s+24,s+24),this.ctx.fillStyle="#000000";const i=s/29,n=this.generateHighQualityQRPattern();this.ctx.imageSmoothingEnabled=!1;for(let o=0;o<29;o++)for(let s=0;s<29;s++)n[o]&&n[o][s]&&this.ctx.fillRect(Math.floor(e+s*i),Math.floor(t+o*i),Math.ceil(i),Math.ceil(i));this.ctx.strokeStyle="#333333",this.ctx.lineWidth=3,this.ctx.strokeRect(e-6,t-6,s+12,s+12),this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=1,this.ctx.strokeRect(e-1,t-1,s+2,s+2),this.ctx.fillStyle="#666666",this.ctx.font='10px -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif',this.ctx.textAlign="center",this.ctx.fillText("扫码访问新闻",e+s/2,t+s+28);const r=a.length>30?a.substring(0,27)+"...":a;this.ctx.fillStyle="#999999",this.ctx.font='8px -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif',this.ctx.fillText(r,e+s/2,t+s+40)}generateHighQualityQRPattern(){const e=Array(29).fill(0).map(()=>Array(29).fill(0));this.drawQRFinderPattern(e,0,0),this.drawQRFinderPattern(e,0,21),this.drawQRFinderPattern(e,21,0);for(let t=8;t<21;t++)e[6][t]=t%2,e[t][6]=t%2;return this.drawAlignmentPattern(e,22,22),this.drawFormatInformation(e),this.fillDataArea(e),e}drawQRFinderPattern(e,t,s){for(let a=0;a<7;a++)for(let i=0;i<7;i++){const n=t+a,r=s+i;n<29&&r<29&&(e[n][r]=0===a||6===a||0===i||6===i?1:1===a||5===a||1===i||5===i?0:1)}for(let a=0;a<8;a++)t+7<29&&s+a<29&&(e[t+7][s+a]=0),s+7<29&&t+a<29&&(e[t+a][s+7]=0)}drawAlignmentPattern(e,t,s){for(let a=-2;a<=2;a++)for(let i=-2;i<=2;i++){const n=t+a,r=s+i;n>=0&&n<29&&r>=0&&r<29&&(2===Math.abs(a)||2===Math.abs(i)||0===a&&0===i?e[n][r]=1:e[n][r]=0)}}drawFormatInformation(e){const t=[1,0,1,0,1,0,0,0,0,1,1,1,0,1,0];for(let s=0;s<6;s++)e[8][s]=t[s];e[8][7]=t[6],e[8][8]=t[7];for(let s=7;s<15;s++)e[8][14+s]=t[s];for(let s=0;s<8;s++)e[28-s][8]=t[s];for(let s=8;s<15;s++)e[15-s][8]=t[s]}fillDataArea(e){for(let t=0;t<29;t++)for(let s=0;s<29;s++)if(0===e[t][s]&&!this.isReservedPosition(t,s)){const a=(31*t+17*s+13*(t+s))%7;e[t][s]=a<3?1:0}}isReservedPosition(e,t){return e<9&&t<9||e<9&&t>19||e>19&&t<9||(6===e||6===t||(Math.abs(e-22)<=2&&Math.abs(t-22)<=2||(8===e&&(t<9||t>19)||8===t&&(e<9||e>19))))}generateEnhancedQRPattern(){const e=Array(25).fill(0).map(()=>Array(25).fill(0));this.drawEnhancedFinderPattern(e,0,0),this.drawEnhancedFinderPattern(e,0,17),this.drawEnhancedFinderPattern(e,17,0);for(let s=8;s<17;s++)e[6][s]=s%2,e[s][6]=s%2;const t=this.generateDataPattern(25);for(let s=0;s<25;s++)for(let a=0;a<25;a++)0!==e[s][a]||this.isEnhancedReservedArea(s,a)||(e[s][a]=t[s][a]);return e}drawEnhancedFinderPattern(e,t,s){for(let a=0;a<7;a++)for(let i=0;i<7;i++){const n=t+a,r=s+i;n<25&&r<25&&(0===a||6===a||0===i||6===i||a>=2&&a<=4&&i>=2&&i<=4)&&(e[n][r]=1)}}generateDataPattern(e){const t=Array(e).fill(0).map(()=>Array(e).fill(0));for(let s=0;s<e;s++)for(let a=0;a<e;a++){const e=(31*s+17*a+s*a*7)%3;t[s][a]=0===e?1:0}return t}isEnhancedReservedArea(e,t){return e<9&&t<9||e<9&&t>15||e>15&&t<9||(6===e||6===t)}wrapText(e,t,s){const a=e.split(""),i=[];let n="";for(const r of a){const e=n+r;this.ctx.measureText(e).width>t&&""!==n?(i.push(n),n=r):n=e}return n&&i.push(n),i}loadImage(e){return new Promise((t,s)=>{const a=new Image;a.crossOrigin="anonymous",a.onload=()=>t(a),a.onerror=s,a.src=e})}downloadPoster(e,t="news-poster.png"){const s=document.createElement("a");s.download=t,s.href=e,document.body.appendChild(s),s.click(),document.body.removeChild(s)}async shareToWeChat(e){try{const t=await fetch(e),s=await t.blob();if(navigator.share&&navigator.canShare&&navigator.canShare({files:[new File([s],"poster.png",{type:"image/png"})]})){const e=new File([s],"news-poster.png",{type:"image/png"});await navigator.share({title:"来自AI推的新闻分享",files:[e]})}else this.showShareTip(e)}catch(t){this.showShareTip(e)}}showShareTip(e){const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0,0,0,0.8);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      z-index: 10000;\n    ";const s=document.createElement("div");s.style.cssText="\n      background: white;\n      padding: 20px;\n      border-radius: 10px;\n      max-width: 90%;\n      max-height: 90%;\n      text-align: center;\n      overflow: auto;\n    ";const a=document.createElement("img");a.src=e,a.style.cssText="\n      max-width: 100%;\n      height: auto;\n      margin-bottom: 20px;\n    ";const i=document.createElement("p");i.textContent="长按图片保存，然后在微信中发送图片即可分享",i.style.cssText="\n      margin: 10px 0;\n      color: #666;\n    ";const n=document.createElement("button");n.textContent="关闭",n.style.cssText="\n      padding: 10px 20px;\n      background: #3498db;\n      color: white;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n    ",n.onclick=()=>document.body.removeChild(t),s.appendChild(a),s.appendChild(i),s.appendChild(n),t.appendChild(s),document.body.appendChild(t)}};t(te,"instance");let se=te;const ae=se.getInstance(),ie=Object.freeze(Object.defineProperty({__proto__:null,PosterShareService:se,posterShareService:ae},Symbol.toStringTag,{value:"Module"})),ne=class e{constructor(){t(this,"imageCache",new Map),t(this,"generationStats",{aiSuccess:0,canvasSuccess:0,totalRequests:0,averageTime:0}),this.initializeService()}static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeService(){}async generateShareImage(e,t={}){const s=Date.now();this.generationStats.totalRequests++;const a={useAI:!0,style:"modern",priority:"normal",fallbackToCanvas:!0,cacheEnabled:!0,...t};try{const t=this.generateCacheKey(e,a);if(a.cacheEnabled&&this.imageCache.has(t))return this.imageCache.get(t);let i;i=a.useAI?await this.generateWithAI(e,a,t):await this.generateWithCanvas(e),a.cacheEnabled&&i&&this.imageCache.set(t,i);const n=Date.now()-s;return this.updateStats(a.useAI&&""!==i,n),i}catch(i){if(a.fallbackToCanvas)try{const t=await this.generateWithCanvas(e);return this.updateStats(!1,Date.now()-s),t}catch(n){}throw i}}async generateWithAI(e,t,s){try{const a={newsData:e,style:t.style,priority:t.priority,cacheKey:s},i=await Y.generateShareImage(a);if(i.success)return this.generationStats.aiSuccess++,i.base64Data||i.imageUrl;throw new Error(`AI生成失败: ${i.error}`)}catch(a){if(t.fallbackToCanvas)return await this.generateWithCanvas(e);throw a}}async generateWithCanvas(e){try{const t=await ae.generateNewsPoster(e);return this.generationStats.canvasSuccess++,t}catch(t){throw t}}async preGenerateImages(e){const t=e.slice(0,10).map(e=>this.generateShareImage(e,{priority:"low",style:"modern",cacheEnabled:!0}).catch(e=>null));(await Promise.allSettled(t)).filter(e=>"fulfilled"===e.status&&e.value).length}generateCacheKey(e,t){const s=`${e.id}-${t.style}-${t.useAI?"ai":"canvas"}`;return btoa(s).replace(/[/+=]/g,"")}updateStats(e,t){e?this.generationStats.aiSuccess++:this.generationStats.canvasSuccess++;this.generationStats.averageTime=.9*this.generationStats.averageTime+.1*t}getServiceStatus(){const e=Y.getServiceStatus(),t=ee.getAvailableServices();return{ai:{services:e,stats:this.generationStats},mcp:{availableServices:t,totalServices:t.length},cache:{size:this.imageCache.size,maxSize:1e3},performance:{totalRequests:this.generationStats.totalRequests,averageTime:Math.round(this.generationStats.averageTime),aiSuccessRate:this.generationStats.totalRequests>0?(this.generationStats.aiSuccess/this.generationStats.totalRequests*100).toFixed(1)+"%":"0%"}}}clearCache(){this.imageCache.clear()}setCacheLimit(e){if(this.imageCache.size>e){const t=Array.from(this.imageCache.entries());t.slice(0,t.length-e).forEach(([e])=>this.imageCache.delete(e))}}getOptimalStyle(e){const t=e.category.toLowerCase();return t.includes("科技")||t.includes("ai")?"modern":t.includes("商业")||t.includes("经济")?"classic":t.includes("设计")||t.includes("艺术")?"minimal":"colorful"}getGenerationRecommendation(e){const t=(new Date).getHours(),s=t>=9&&t<=18;return{useAI:!0,style:this.getOptimalStyle(e),priority:s?"normal":"low",fallbackToCanvas:!0,cacheEnabled:!0}}};t(ne,"instance");const re=ne.getInstance(),oe=class e{constructor(){t(this,"generationQueue",[]),t(this,"isProcessing",!1),t(this,"maxConcurrent",2),t(this,"currentlyGenerating",new Set),t(this,"intersectionObserver",null),t(this,"visibilityThreshold",.1),t(this,"preGenerationDelay",2e3),this.initializeIntersectionObserver(),this.startQueueProcessor()}static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeIntersectionObserver(){"undefined"!=typeof window&&"IntersectionObserver"in window&&(this.intersectionObserver=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target,s=this.extractNewsDataFromElement(t);s&&setTimeout(()=>{this.isElementStillVisible(t)&&this.schedulePreGeneration(s)},this.preGenerationDelay)}})},{threshold:this.visibilityThreshold,rootMargin:"50px"}))}observeNewsElement(e,t){this.intersectionObserver&&(e.setAttribute("data-news-id",t.id),e.setAttribute("data-news-data",JSON.stringify(t)),this.intersectionObserver.observe(e))}unobserveNewsElement(e){this.intersectionObserver&&this.intersectionObserver.unobserve(e)}extractNewsDataFromElement(e){try{const t=e.getAttribute("data-news-data");return t?JSON.parse(t):null}catch(t){return null}}isElementStillVisible(e){const t=e.getBoundingClientRect(),s=0,a=0,i=window.innerHeight,n=window.innerWidth;return t.bottom>=s&&t.top<=i&&t.right>=a&&t.left<=n}schedulePreGeneration(e){if(this.currentlyGenerating.has(e.id)||this.generationQueue.some(t=>t.newsId===e.id))return;const t=this.calculatePriority(e),s={newsId:e.id,priority:t,startTime:Date.now(),status:"pending",retryCount:0};this.insertJobByPriority(s)}calculatePriority(e){let t=50;const s=(Date.now()-new Date(e.publishedAt).getTime())/36e5;s<1?t+=30:s<6?t+=20:s<24&&(t+=10);["国际AI","科技","商业"].some(t=>e.category.includes(t))&&(t+=20);return["TechCrunch","The Verge","Wired"].some(t=>e.source.includes(t))&&(t+=15),t}insertJobByPriority(e){let t=this.generationQueue.length;for(let s=0;s<this.generationQueue.length;s++)if(this.generationQueue[s].priority<e.priority){t=s;break}this.generationQueue.splice(t,0,e),this.generationQueue.length>20&&(this.generationQueue=this.generationQueue.slice(0,20))}startQueueProcessor(){setInterval(async()=>{!this.isProcessing&&this.generationQueue.length>0&&await this.processQueue()},1e3)}async processQueue(){if(!this.isProcessing){this.isProcessing=!0;try{const e=this.generationQueue.filter(e=>"pending"===e.status).slice(0,this.maxConcurrent);if(0===e.length)return void(this.isProcessing=!1);const t=e.map(async e=>{e.status="generating",this.currentlyGenerating.add(e.newsId);try{const t=await this.getNewsData(e.newsId);if(!t)throw new Error("News data not found");await re.generateShareImage(t,{useAI:!0,priority:"low",style:re.getOptimalStyle(t),cacheEnabled:!0,fallbackToCanvas:!0}),e.status="completed"}catch(t){e.retryCount++,e.retryCount>=2?e.status="failed":e.status="pending"}finally{this.currentlyGenerating.delete(e.newsId)}});await Promise.allSettled(t),this.generationQueue=this.generationQueue.filter(e=>"completed"!==e.status&&"failed"!==e.status)}finally{this.isProcessing=!1}}}async getNewsData(e){try{const t=document.querySelectorAll(`[data-news-id="${e}"]`);return t.length>0?this.extractNewsDataFromElement(t[0]):null}catch(t){return null}}async preGenerateHotNews(e){e.forEach(e=>{this.schedulePreGeneration(e)})}getStats(){return{queueLength:this.generationQueue.length,currentlyGenerating:this.currentlyGenerating.size,completedToday:0,failedToday:0}}destroy(){this.intersectionObserver&&this.intersectionObserver.disconnect(),this.generationQueue=[],this.currentlyGenerating.clear()}};t(oe,"instance");const ce=oe.getInstance(),le=({id:e,title:t,summary:i,imageUrl:n,source:r,publishedAt:c,category:l})=>{const{getLocalizedCategory:d}=G(),h=a.useRef(null);a.useEffect(()=>{if(h.current){const s={id:e,title:t,summary:i,imageUrl:n,publishedAt:c,source:r,category:l};return ce.observeNewsElement(h.current,s),()=>{h.current&&ce.unobserveNewsElement(h.current)}}},[e,t,i,n,c,r,l]);const m=t,u=i,f=(e,t)=>{const s=document.createElement("div");s.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n      z-index: 9999;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;\n    ";const a=document.createElement("div");a.style.cssText="\n      background: white;\n      border-radius: 12px;\n      padding: 24px;\n      margin: 20px;\n      max-width: 320px;\n      text-align: center;\n      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n      position: relative;\n    ";const i=document.createElement("div");i.style.cssText="\n      position: absolute;\n      top: -40px;\n      right: 20px;\n      width: 0;\n      height: 0;\n      border-left: 20px solid transparent;\n      border-right: 20px solid transparent;\n      border-bottom: 40px solid #007AFF;\n      animation: bounce 1s infinite;\n    ";const n=document.createElement("style");n.textContent="\n      @keyframes bounce {\n        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }\n        40% { transform: translateY(-10px); }\n        60% { transform: translateY(-5px); }\n      }\n    ",document.head.appendChild(n),a.innerHTML='\n      <div style="color: #007AFF; font-size: 24px; margin-bottom: 16px;">📤</div>\n      <h3 style="margin: 0 0 16px 0; color: #333; font-size: 18px; font-weight: 600;">\n        分享到微信\n      </h3>\n      <p style="margin: 0 0 20px 0; color: #666; font-size: 14px; line-height: 1.5;">\n        请点击微信右上角的 <strong>"···"</strong> 菜单按钮<br>\n        选择 <strong>"分享给朋友"</strong> 或 <strong>"分享到朋友圈"</strong>\n      </p>\n      <div style="display: flex; gap: 12px; margin-top: 20px;">\n        <button id="wechat-copy-link" style="\n          flex: 1;\n          background: #f0f0f0;\n          border: none;\n          padding: 12px;\n          border-radius: 8px;\n          font-size: 14px;\n          color: #333;\n          cursor: pointer;\n        ">复制链接</button>\n        <button id="wechat-close-guide" style="\n          flex: 1;\n          background: #007AFF;\n          border: none;\n          padding: 12px;\n          border-radius: 8px;\n          font-size: 14px;\n          color: white;\n          cursor: pointer;\n        ">知道了</button>\n      </div>\n    ',a.appendChild(i),s.appendChild(a),document.body.appendChild(s);const r=a.querySelector("#wechat-copy-link"),o=a.querySelector("#wechat-close-guide");r?.addEventListener("click",()=>{if(navigator.clipboard)navigator.clipboard.writeText(e).then(()=>{r.textContent="已复制!",setTimeout(()=>{document.body.removeChild(s),document.head.removeChild(n)},1e3)});else{const t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),r.textContent="已复制!",setTimeout(()=>{document.body.removeChild(s),document.head.removeChild(n)},1e3)}}),o?.addEventListener("click",()=>{document.body.removeChild(s),document.head.removeChild(n)}),s.addEventListener("click",e=>{e.target===s&&(document.body.removeChild(s),document.head.removeChild(n))})};return s.jsx(U,{to:`/news/${e}`,className:"block",children:s.jsxs(z,{ref:h,className:"cursor-pointer overflow-hidden bg-gradient-card border border-border/50 shadow-soft hover:shadow-medium transition-all duration-300 transform hover:-translate-y-1 group",children:[s.jsx(L,{className:"p-0",children:s.jsxs("div",{className:"relative overflow-hidden rounded-t-lg",children:[s.jsx("img",{src:n,alt:m,className:"w-full h-48 object-cover transition-transform duration-300 group-hover:scale-105",loading:"lazy",onError:e=>{const t=e.target;if(t.src.includes("unsplash.com/photo-1677442136019-21780ecad995"))return;const s=m.toLowerCase();s.includes("ai")||s.includes("人工智能")||s.includes("大模型")||s.includes("chatgpt")?t.src="https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&h=600&fit=crop&auto=format":s.includes("机器人")||s.includes("自动化")||s.includes("自动驾驶")?t.src="https://images.unsplash.com/photo-1485827404703-89b55fcc595e?w=800&h=600&fit=crop&auto=format":s.includes("科技")||s.includes("技术")||s.includes("芯片")?t.src="https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=800&h=600&fit=crop&auto=format":s.includes("数据")||s.includes("代码")||s.includes("编程")?t.src="https://images.unsplash.com/photo-1555066931-4365d14bab8c?w=800&h=600&fit=crop&auto=format":t.src="https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&h=600&fit=crop&auto=format"}}),s.jsx("div",{className:"absolute top-3 left-3",children:s.jsx(Q,{className:(e=>{const t=e.toLowerCase();return t.includes("ai")||t.includes("ai模型")||t.includes("ai 模型")?"bg-gradient-ai text-white border-0":t.includes("tech")||t.includes("科技")?"bg-gradient-tech text-white border-0":t.includes("economy")||t.includes("经济")?"bg-gradient-economy text-white border-0":t.includes("analysis")||t.includes("深度分析")?"bg-gradient-analysis text-white border-0":"bg-gradient-primary text-white border-0"})(l),children:d(l)})}),s.jsx("div",{className:"absolute top-3 right-3",children:s.jsx(q,{size:"sm",variant:"secondary",className:"h-8 w-8 p-0 bg-white/90 hover:bg-white text-gray-700 hover:text-gray-900 opacity-0 group-hover:opacity-100 transition-opacity duration-300",onClick:t=>{t.stopPropagation(),t.preventDefault();const s=o(e),a=`${m} - 来自AI推`;if(/micromessenger/i.test(navigator.userAgent))f(s);else if(navigator.share)navigator.share({title:a,text:u.substring(0,100)+"...",url:s}).catch(console.error);else if(navigator.clipboard)navigator.clipboard.writeText(s).then(()=>{alert("链接已复制到剪贴板！")});else{const e=encodeURIComponent(a),t=encodeURIComponent(s),i=[{name:"微博",url:`https://service.weibo.com/share/share.php?url=${t}&title=${e}`},{name:"QQ",url:`https://connect.qq.com/widget/shareqq/index.html?url=${t}&title=${e}`},{name:"Twitter",url:`https://twitter.com/intent/tweet?text=${e}&url=${t}`}];if(confirm("选择分享方式：\n确定 - 复制链接\n取消 - 打开微博分享")){const e=document.createElement("input");e.value=s,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),alert("链接已复制到剪贴板！")}else window.open(i[0].url,"_blank","width=600,height=400")}},children:s.jsx(g,{className:"w-4 h-4"})})}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})}),s.jsxs(O,{className:"p-4 space-y-3",children:[s.jsx("h3",{className:"font-semibold text-lg leading-tight text-foreground line-clamp-2 group-hover:text-primary transition-colors duration-200",children:m}),s.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed line-clamp-4",children:u}),s.jsxs("div",{className:"flex items-center justify-between pt-2",children:[s.jsxs("div",{className:"flex items-center space-x-2 text-xs text-muted-foreground",children:[s.jsx(p,{className:"w-3 h-3"}),s.jsx("span",{className:"font-medium",children:r})]}),s.jsxs("div",{className:"flex items-center space-x-1 text-xs text-muted-foreground",children:[s.jsx(x,{className:"w-3 h-3"}),s.jsx("span",{children:(e=>{try{const t=new Date(e),s=new Date;if(isNaN(t.getTime()))return"时间未知";const a=s.getTime()-t.getTime(),i=Math.abs(a);if(i<6e4)return"刚刚发布";const n=a<0?i:a,r=Math.floor(n/6e4),o=Math.floor(n/36e5),c=Math.floor(n/864e5);return r<60?`${r}分钟前`:o<24?`${o}小时前`:`${c}天前`}catch(t){return"时间未知"}})(c)})]})]})]})]})})},de=({isOpen:e,onClose:t,onMenuClick:a})=>{const{isZh:n}=i(),r=B(),o=[{id:"home",icon:w,label:n?"首页":"Home",description:n?"返回新闻主页":"Back to news home",path:"/",isExternal:!1},{id:"blog",icon:b,label:n?"AI博客":"AI Blog",description:n?"深度AI技术解读":"In-depth AI analysis",path:"/blog",isExternal:!1},{id:"about",icon:v,label:n?"关于我们":"About Us",description:n?"了解AI推团队":"Learn about AI Push",path:"/about",isExternal:!1},{id:"services",icon:j,label:n?"服务介绍":"Services",description:n?"我们提供的服务":"Services we provide",path:"/services",isExternal:!1},{id:"contact",icon:C,label:n?"联系我们":"Contact Us",description:n?"获取帮助和支持":"Get help and support",path:"/contact",isExternal:!1}],c=[{id:"daily-briefing",icon:N,label:n?"AI专题简报":"AI Topic Briefing",description:n?"实时AI新闻精选":"Real-time AI News Selection",isExternal:!0},{id:"disclaimer",icon:A,label:n?"免责声明":"Disclaimer",description:n?"网站使用条款":"Website Terms",isExternal:!0}],l=e=>{e.isExternal?a(e.id):(r(e.path),t())};return s.jsxs(s.Fragment,{children:[e&&s.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:t}),s.jsxs("div",{className:`\n        fixed top-0 left-0 h-full w-80 bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out\n        ${e?"translate-x-0":"-translate-x-full"}\n      `,children:[s.jsxs("div",{className:"flex items-center justify-between p-6 bg-gradient-hero text-white",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(d,{className:"w-5 h-5"}),s.jsx("h2",{className:"text-lg font-semibold",children:n?"菜单":"Menu"})]}),s.jsx("button",{onClick:t,className:"p-1 hover:bg-white/20 rounded-full transition-colors",children:s.jsx(f,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide px-2 mb-3",children:n?"网站导航":"Navigation"}),o.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>l(e),className:"w-full flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-50 transition-colors text-left group",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(t,{className:"w-5 h-5 text-gray-600 group-hover:text-blue-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-gray-900 group-hover:text-blue-600",children:e.label}),s.jsx("div",{className:"text-sm text-gray-500",children:e.description})]})]},e.id)})]}),s.jsx("div",{className:"border-t border-gray-200"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide px-2 mb-3",children:n?"功能菜单":"Features"}),c.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>l(e),className:"w-full flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-50 transition-colors text-left group",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(t,{className:"w-5 h-5 text-gray-600 group-hover:text-blue-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-gray-900 group-hover:text-blue-600",children:e.label}),s.jsx("div",{className:"text-sm text-gray-500",children:e.description})]}),s.jsx(p,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"})]},e.id)})]})]}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200",children:s.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[s.jsx(y,{className:"w-4 h-4"}),s.jsx("span",{children:n?"有问题请联系我们":"Contact us for questions"})]})})]})]})},he=({isOpen:e,onClose:t})=>{const{isZh:n}=i(),{getLocalizedNewsArray:r}=G(),[o,c]=a.useState([]),[l,d]=a.useState(!0),m=(new Date).toLocaleDateString(n?"zh-CN":"en-US",{year:"numeric",month:"long",day:"numeric"});a.useEffect(()=>{e&&u()},[e]);const u=async()=>{d(!0);try{const e=await fetch("/news-data.json?"+Date.now()),t=await e.json();if(t.success&&t.data){const e=t.data.filter(e=>{const t=(e.title||"").toLowerCase(),s=((e.category||"").toLowerCase(),(e.summary||"").toLowerCase()),a=(e.content||"").toLowerCase();if(["cryptocurrency","bitcoin","blockchain","加密货币","比特币","cybersecurity","网络攻击","data breach","数据泄露","quantum computing","量子计算","startup funding","创业融资"].some(e=>t.includes(e)||s.includes(e)))return!1;let i=0;return["ai","artificial intelligence","人工智能","machine learning","机器学习","deep learning","深度学习","neural network","神经网络","chatgpt","gpt","openai","anthropic","claude","llm","large language model","大语言模型","generative ai","生成式ai","transformer","diffusion model","stable diffusion","midjourney","dall-e","computer vision","计算机视觉","nlp","natural language","自然语言处理","conversational ai","对话式ai","prompt engineering","提示工程"].forEach(e=>{t.includes(e)&&(i+=3),s.includes(e)&&(i+=2),a.includes(e)&&(i+=1)}),["openai","anthropic","deepmind","hugging face","nvidia ai","google deepmind","microsoft ai","meta ai","apple intelligence","amazon ai","transformer architecture","attention mechanism","注意力机制","reinforcement learning","强化学习","supervised learning","监督学习","unsupervised learning","无监督学习","foundation model","基础模型","multimodal ai","多模态ai","autonomous system","自主系统"].forEach(e=>{t.includes(e)&&(i+=2),s.includes(e)&&(i+=1)}),i>=3}).slice(0,10),s=r(e).map((e,t)=>({id:e.id||`briefing_${t}`,description:e.title||(e.aiInsight?e.aiInsight.length>80?e.aiInsight.substring(0,80)+"...":e.aiInsight:e.summary?e.summary.length>80?e.summary.substring(0,80)+"...":e.summary:n?"暂无描述":"No description"),category:e.category||"AI",importance:t<3?"high":t<7?"medium":"low",timestamp:e.publishedAt||(new Date).toISOString()}));c(s)}}catch(e){}finally{d(!1)}},g=e=>{switch(e){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},p=e=>{switch(e){case"high":return n?"重要":"High";case"medium":return n?"一般":"Medium";case"low":return n?"关注":"Low";default:return""}};return e?s.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[s.jsxs("div",{className:"bg-gradient-hero text-white p-6 relative",children:[s.jsx("button",{onClick:t,className:"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-full transition-colors",children:s.jsx(f,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[s.jsx(h,{className:"w-6 h-6"}),s.jsx("h2",{className:"text-2xl font-bold",children:n?"AI 专题简报":"AI Topic Briefing"})]}),s.jsxs("div",{className:"flex items-center space-x-2 text-sm opacity-90",children:[s.jsx(S,{className:"w-4 h-4"}),s.jsx("span",{children:m}),s.jsx(x,{className:"w-4 h-4 ml-4"}),s.jsx("span",{children:n?"实时AI新闻":"Real-time AI News"})]})]}),s.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:l?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsxs("div",{className:"flex items-center space-x-2 text-gray-500",children:[s.jsx(I,{className:"w-5 h-5 animate-spin"}),s.jsx("span",{children:n?"正在生成AI专题晨报...":"Generating AI briefing..."})]})}):s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:s.jsx("p",{className:"text-sm text-blue-800",children:n?"本AI专题简报精选10条纯人工智能领域重要新闻，基于站内实时新闻数据智能筛选，确保内容与AI技术、应用和发展直接相关。":"This AI topic briefing features 10 selected important news purely from the artificial intelligence field, using intelligent algorithms to filter real-time news data, ensuring content is directly related to AI technology, applications, and development."})}),o.map((e,t)=>s.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsxs("span",{className:"text-lg font-bold text-gray-400 flex-shrink-0",children:["#",t+1]}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx("span",{className:`px-2 py-1 text-xs rounded-full border ${g(e.importance)}`,children:p(e.importance)}),s.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:e.category})]}),s.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:e.description}),s.jsx("div",{className:"flex items-center justify-between text-xs text-gray-400 mt-2",children:s.jsx("span",{children:new Date(e.timestamp).toLocaleTimeString()})})]})]})},e.id))]})}),s.jsx("div",{className:"border-t border-gray-200 p-4 bg-gray-50",children:s.jsx("div",{className:"text-center",children:s.jsx("p",{className:"text-sm text-gray-500",children:n?"AI专题简报基于站内实时新闻数据生成，持续关注人工智能领域最新动态":"AI topic briefing is generated based on real-time news data, continuously tracking the latest developments in artificial intelligence"})})})]})}):null},me=({isOpen:e,onClose:t})=>{const{isZh:a}=i(),n=[{icon:k,title:a?"内容来源声明":"Content Source Declaration",content:a?"本网站所有新闻内容均来源于权威新闻网站的公开API接口，包括但不限于Reuters、Bloomberg、TechCrunch、The Verge等国际知名媒体。我们仅作为信息中转和聚合平台，不对原始内容进行任何修改或编辑。":"All news content on this website is sourced from authoritative news websites through public API interfaces, including but not limited to Reuters, Bloomberg, TechCrunch, The Verge and other internationally renowned media. We serve only as an information relay and aggregation platform without any modification or editing of original content."},{icon:T,title:a?"AI翻译免责":"AI Translation Disclaimer",content:a?"本网站使用AI技术对英文新闻进行中文翻译，AI翻译可能存在理解偏差、语境错误或专业术语翻译不准确的情况。翻译内容仅供参考，重要信息请以原文为准。我们建议用户在做出重要决策前，务必查阅原始英文报道。":"This website uses AI technology to translate English news into Chinese. AI translation may have understanding deviations, contextual errors, or inaccurate professional terminology translation. Translated content is for reference only, and important information should be based on the original text. We recommend users to consult the original English reports before making important decisions."},{icon:A,title:a?"内容准确性声明":"Content Accuracy Statement",content:a?"虽然我们努力确保信息的及时性和准确性，但由于网络传输、API接口延迟、第三方数据源更新等技术因素，内容可能存在延迟或错误。本网站不保证所提供信息的完整性、准确性、可靠性或时效性。":"While we strive to ensure the timeliness and accuracy of information, content may be delayed or contain errors due to technical factors such as network transmission, API interface delays, and third-party data source updates. This website does not guarantee the completeness, accuracy, reliability, or timeliness of the information provided."},{icon:p,title:a?"第三方链接责任":"Third-party Link Responsibility",content:a?"本网站包含指向第三方网站的链接，这些链接仅为用户提供便利。我们对这些外部网站的内容、隐私政策、服务条款或其他做法不承担任何责任。用户访问第三方网站时，应自行了解并遵守该网站的相关条款。":"This website contains links to third-party websites, which are provided solely for user convenience. We assume no responsibility for the content, privacy policies, terms of service, or other practices of these external websites. Users should understand and comply with the relevant terms of those websites when accessing third-party sites."}];return e?s.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[s.jsxs("div",{className:"bg-gradient-to-r from-gray-700 to-gray-900 text-white p-6 relative",children:[s.jsx("button",{onClick:t,className:"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-full transition-colors",children:s.jsx(f,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[s.jsx(k,{className:"w-6 h-6"}),s.jsx("h2",{className:"text-2xl font-bold",children:a?"免责声明":"Disclaimer"})]}),s.jsx("p",{className:"text-sm opacity-90",children:a?"使用本网站前，请仔细阅读以下声明":"Please read the following disclaimer carefully before using this website"})]}),s.jsxs("div",{className:"p-6 overflow-y-auto max-h-[70vh]",children:[s.jsxs("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(T,{className:"w-5 h-5 text-yellow-600"}),s.jsx("h3",{className:"font-semibold text-yellow-800",children:a?"重要提示":"Important Notice"})]}),s.jsx("p",{className:"text-sm text-yellow-700",children:a?"本网站提供的所有信息仅供参考和教育目的，不构成任何形式的投资建议、法律建议或其他专业建议。用户在使用本网站信息时应谨慎行事，并承担相应风险。":"All information provided on this website is for reference and educational purposes only and does not constitute any form of investment advice, legal advice, or other professional advice. Users should exercise caution when using information from this website and bear corresponding risks."})]}),s.jsx("div",{className:"space-y-6",children:n.map((e,t)=>{const a=e.icon;return s.jsxs("div",{className:"border border-gray-200 rounded-lg p-5",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[s.jsx("div",{className:"flex-shrink-0 p-2 bg-blue-100 rounded-lg",children:s.jsx(a,{className:"w-5 h-5 text-blue-600"})}),s.jsx("h3",{className:"font-semibold text-gray-900",children:e.title})]}),s.jsx("p",{className:"text-sm text-gray-600 leading-relaxed ml-11",children:e.content})]},t)})}),s.jsxs("div",{className:"mt-8 bg-gray-50 border border-gray-200 rounded-lg p-5",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:a?"联系我们":"Contact Us"}),s.jsx("p",{className:"text-sm text-gray-600 mb-3",children:a?"如果您对本免责声明有任何疑问，或者发现内容错误需要纠正，请通过以下方式联系我们：":"If you have any questions about this disclaimer or find content errors that need correction, please contact us through:"}),s.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[s.jsx(p,{className:"w-4 h-4 text-blue-600"}),s.jsx("span",{className:"text-blue-600",children:a?"微信：forxy9":"WeChat: forxy9"})]})]}),s.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200 text-center",children:s.jsxs("p",{className:"text-xs text-gray-500",children:[a?"最后更新时间：":"Last updated: ",(new Date).toLocaleDateString(a?"zh-CN":"en-US")]})})]}),s.jsx("div",{className:"border-t border-gray-200 p-4 bg-gray-50",children:s.jsx("div",{className:"flex justify-end space-x-3",children:s.jsx("button",{onClick:t,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:a?"我已阅读并理解":"I have read and understand"})})})]})}):null},ue=({isOpen:e,onClose:t})=>{const{isZh:n}=i(),[r,o]=a.useState(""),[c,l]=a.useState(!1),[d,h]=a.useState("idle"),[m,u]=a.useState("");return e?s.jsx(s.Fragment,{children:s.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:t,children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(C,{className:"w-6 h-6 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:n?"订阅AI新闻":"Subscribe to AI News"}),s.jsx("p",{className:"text-sm text-gray-500",children:n?"获取最新AI资讯推送":"Get latest AI news updates"})]})]}),s.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:s.jsx(f,{className:"w-5 h-5 text-gray-400"})})]}),s.jsx("div",{className:"p-6",children:"success"===d?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(P,{className:"w-8 h-8 text-green-600"})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:n?"订阅成功！":"Subscription Successful!"}),s.jsx("p",{className:"text-gray-500 mb-4",children:n?"感谢您的订阅，我们会将最新AI新闻发送到您的邮箱。":"Thank you for subscribing! We will send the latest AI news to your email."}),s.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:n?"关闭":"Close"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r))return u(n?"请输入有效的邮箱地址":"Please enter a valid email address"),void h("error");l(!0),h("idle"),u("");try{const e=void 0,s=void 0;if(!e||!s)throw new Error("Brevo MCP configuration missing");const a=await fetch("https://api.brevo.com/v3/contacts",{method:"POST",headers:{"api-key":e,"Content-Type":"application/json","X-MCP-Protocol":"v1","X-Application":"AI-News-Website"},body:JSON.stringify({email:r,listIds:[parseInt(s)],updateEnabled:!0,attributes:{FNAME:"",LNAME:"",SOURCE:"AI-News-Website",SUBSCRIBE_DATE:(new Date).toISOString()}})});if(a.ok)h("success"),o(""),setTimeout(()=>{t(),h("idle")},3e3);else{"duplicate_parameter"===(await a.json()).code?u(n?"该邮箱已经订阅过了":"This email is already subscribed"):u(n?"订阅失败，请稍后再试":"Subscription failed, please try again later"),h("error")}}catch(s){h("error"),u(n?"网络错误，请稍后再试":"Network error, please try again later")}finally{l(!1)}},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:n?"邮箱地址":"Email Address"}),s.jsx("input",{type:"email",id:"email",value:r,onChange:e=>o(e.target.value),placeholder:n?"请输入您的邮箱地址":"Enter your email address",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),"error"===d&&s.jsxs("div",{className:"flex items-center space-x-2 text-red-600 bg-red-50 p-3 rounded-lg",children:[s.jsx(R,{className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:m})]}),s.jsx("button",{type:"submit",disabled:c,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:c?s.jsxs(s.Fragment,{children:[s.jsx(I,{className:"w-5 h-5 animate-spin"}),s.jsx("span",{children:n?"订阅中...":"Subscribing..."})]}):s.jsxs(s.Fragment,{children:[s.jsx(C,{className:"w-5 h-5"}),s.jsx("span",{children:n?"立即订阅":"Subscribe Now"})]})})]}),s.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-gray-500 mb-4",children:n?"或者使用RSS阅读器订阅":"Or subscribe with RSS reader"}),s.jsxs("button",{onClick:()=>{window.open("/rss.xml","_blank")},className:"flex items-center justify-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.479 3.29-3.293 3.29-1.814 0-3.292-1.477-3.292-3.29 0-1.816 1.478-3.295 3.292-3.295zM12.906 24c0-6.627-5.373-12-12-12v-2.4c8.159 0 14.4 6.242 14.4 14.4h-2.4z"})}),s.jsx("span",{children:n?"RSS订阅":"RSS Feed"})]})]})}),s.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:n?"订阅须知":"Subscription Information"}),s.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[s.jsxs("li",{children:["• ",n?"每日推送最新AI新闻":"Daily latest AI news updates"]}),s.jsxs("li",{children:["• ",n?"可以随时取消订阅":"Unsubscribe anytime"]}),s.jsxs("li",{children:["• ",n?"不会发送垃圾邮件":"No spam emails"]}),s.jsxs("li",{children:["• ",n?"保护您的隐私":"Protect your privacy"]})]})]})]})})]})})}):null};const ge=new class{constructor(){t(this,"cache",new Map),t(this,"CACHE_DURATION",3e5)}set(e,t){this.cache.set(e,{data:[...t],timestamp:Date.now()})}get(e){const t=this.cache.get(e);return t?Date.now()-t.timestamp>this.CACHE_DURATION?(this.cache.delete(e),null):[...t.data]:null}clear(){this.cache.clear()}},pe=()=>{const[e,t]=a.useState([]),[s,i]=a.useState(!0),[n,r]=a.useState("全部"),[o,c]=a.useState(null),[l,d]=a.useState(0),{filterNews:h}=(()=>{const e=(e,t,s)=>{const a=`${e} ${t} ${s}`.toLowerCase();return["artificial intelligence","machine learning","deep learning","ai model","algorithm","computer science","technology","innovation","research","development","programming","software","hardware","data science","neural network","automation","robotics","computer vision","natural language processing","blockchain","cryptocurrency"].some(e=>a.includes(e))||["ai","科技","tech","technology","经济","economy","business"].some(e=>s.toLowerCase().includes(e)),!0};return{isContentSafe:e,filterNews:t=>t.filter(t=>{if("InfoQ中文"===t.source){const e=t.title||"",s=t.content||"";if(e.includes("AICon")||e.includes("挑战赛")||e.includes("开启")||e.includes("启动")||e.includes("技术岗位")&&e.includes("占比")||e.includes("秋招")||e.length<20||s.trim().length<100)return!1}const s=t.title||"";return!!["谷歌","Google","微软","Microsoft","苹果","Apple","亚马逊","Amazon","Meta","Facebook","OpenAI","ChatGPT","AI","人工智能","机器学习","Opal","实验室","算法","深度学习","neural","云计算"].some(e=>s.toLowerCase().includes(e.toLowerCase()))||e(t.title||"",t.content||t.summary||"",t.category||"")})}})(),{getLocalizedNewsArray:m,getLocalizedCategory:u}=G(),g=a.useCallback(e=>{const t=h(e).sort((e,t)=>{const s=new Date(e.publishedAt).getTime();return new Date(t.publishedAt).getTime()-s});return m(t)},[h,m]),p=a.useCallback(async(e=!1)=>{const s=Date.now();if(e||!(s-l<3e4)){i(!0),c(null);try{const a=await(async(e=!1)=>{const t="news-data";if(!e){const e=ge.get(t);if(e)return e}const s=/micromessenger/i.test(navigator.userAgent),a=Date.now(),i=`/news-data.json?${new URLSearchParams({t:a.toString(),v:"2",...e&&{force:"1"}})}`;try{const e=await fetch(i,{cache:"no-cache",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0",...s&&{"User-Agent":"WeChat"}}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const a=await e.json();if(a?.success&&a?.data&&Array.isArray(a.data))return ge.set(t,a.data),a.data;throw new Error("新闻数据格式错误")}catch(o){const s=ge.get(t);if(s)return s;throw o}})(e),i=g(a);t(i),d(s)}catch(a){c(a instanceof Error?a.message:"网络连接错误，请检查网络设置")}finally{i(!1)}}},[g,l]);a.useEffect(()=>{p();const e=setInterval(()=>{p(!0)},3e5);return()=>{clearInterval(e)}},[p]);const x=a.useMemo(()=>[...n===u("全部")?e:e.filter(e=>u(e.category)===n)].sort((e,t)=>{const s=new Date(e.publishedAt).getTime();return new Date(t.publishedAt).getTime()-s}),[e,n,u]),f=["全部","中国AI","国际AI","科技新闻","AI趣味新闻"],y=a.useMemo(()=>f.map(e=>u(e)),[u]),w=a.useCallback(()=>{ge.clear(),p(!0)},[p]);return{news:x,loading:s,error:o,categories:y,selectedCategory:n,setSelectedCategory:r,refreshNews:w,lastFetchTime:l}},xe=()=>{const{news:e,loading:t,error:n,categories:r,selectedCategory:o,setSelectedCategory:l,refreshNews:d}=pe(),{isZh:h}=i(),[m,u]=a.useState(new Date),[g,p]=a.useState(!1),[f,y]=a.useState(!1),[w,b]=a.useState(!1),[v,j]=a.useState(!1);a.useEffect(()=>{!t&&!n&&e.length>0&&u(new Date)},[e,t,n]);const C=()=>{d(),u(new Date)};return s.jsxs(s.Fragment,{children:[s.jsxs(c,{children:[s.jsx("title",{children:"AI推 - 最新AI资讯聚合平台"}),s.jsx("meta",{name:"description",content:"AI推为您聚合最新的人工智能资讯、技术动态、深度分析和行业趋势，让您第一时间了解AI领域的最新发展。"}),s.jsx("link",{rel:"canonical",href:"https://news.aipush.fun/"}),s.jsx("meta",{name:"robots",content:"index,follow"}),s.jsx("meta",{name:"googlebot",content:"index,follow"}),s.jsx("meta",{name:"wxcard:title",content:"AI推 - 最新AI资讯聚合平台"}),s.jsx("meta",{name:"wxcard:desc",content:"AI推为您聚合最新的人工智能资讯、技术动态、深度分析和行业趋势，让您第一时间了解AI领域的最新发展。"}),s.jsx("meta",{name:"wxcard:imgUrl",content:`${window.location.origin}/wechat-share-300.png?v=2025080802`}),s.jsx("meta",{name:"wxcard:link",content:window.location.origin}),s.jsx("meta",{property:"og:type",content:"website"}),s.jsx("meta",{property:"og:url",content:window.location.origin}),s.jsx("meta",{property:"og:title",content:"AI推 - 最新AI资讯聚合平台"}),s.jsx("meta",{property:"og:description",content:"AI推为您聚合最新的人工智能资讯、技术动态、深度分析和行业趋势，让您第一时间了解AI领域的最新发展。"}),s.jsx("meta",{property:"og:image",content:`${window.location.origin}/wechat-share-300.png?v=2025080802`}),s.jsx("meta",{property:"og:image:width",content:"300"}),s.jsx("meta",{property:"og:image:height",content:"300"}),s.jsx("meta",{property:"og:image:type",content:"image/png"}),s.jsx("meta",{property:"og:site_name",content:"AI推"}),s.jsx("meta",{property:"twitter:card",content:"summary_large_image"}),s.jsx("meta",{property:"twitter:url",content:window.location.origin}),s.jsx("meta",{property:"twitter:title",content:"AI推 - 最新AI资讯聚合平台"}),s.jsx("meta",{property:"twitter:description",content:"AI推为您聚合最新的人工智能资讯、技术动态、深度分析和行业趋势，让您第一时间了解AI领域的最新发展。"}),s.jsx("meta",{property:"twitter:image",content:`${window.location.origin}/wechat-share-300.png?v=2025080802`})]}),s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(H,{onMenuClick:()=>p(!0)}),s.jsx(de,{isOpen:g,onClose:()=>p(!1),onMenuClick:e=>{switch(p(!1),e){case"daily-briefing":y(!0);break;case"rss-subscribe":j(!0);break;case"disclaimer":b(!0)}}}),s.jsx(he,{isOpen:f,onClose:()=>y(!1)}),s.jsx(me,{isOpen:w,onClose:()=>b(!1)}),s.jsx(ue,{isOpen:v,onClose:()=>j(!1)}),s.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-6 space-y-6",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx(K,{categories:r,activeCategory:o,onCategoryChange:l})}),!n&&s.jsxs("div",{className:"flex items-center justify-between bg-muted/50 rounded-lg px-4 py-3",children:[s.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[s.jsx(x,{className:"w-4 h-4"}),s.jsx("span",{children:(e=>{const t=(new Date).getTime()-e.getTime(),s=Math.floor(t/6e4);if(s<1)return h?"刚刚更新":"Just updated";if(s<60)return h?`${s}分钟前更新`:`Updated ${s}m ago`;{const e=Math.floor(s/60);return h?`${e}小时前更新`:`Updated ${e}h ago`}})(m)}),s.jsxs("span",{className:"text-xs opacity-75",children:["• ",h?"每5分钟自动刷新":"Auto refresh every 5min"]})]}),s.jsxs("button",{onClick:C,disabled:t,className:"flex items-center space-x-2 px-3 py-1.5 bg-primary/10 hover:bg-primary/20 text-primary rounded-md transition-colors disabled:opacity-50",children:[s.jsx(E,{className:"w-4 h-4 "+(t?"animate-spin":"")}),s.jsx("span",{className:"text-sm",children:h?"刷新":"Refresh"})]})]}),n&&s.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[s.jsxs("div",{className:"text-red-500 mb-4 text-center",children:[s.jsx("p",{className:"font-semibold",children:h?"新闻获取失败":"Failed to fetch news"}),s.jsx("p",{className:"text-sm",children:n})]}),s.jsxs("button",{onClick:C,disabled:t,className:"flex items-center space-x-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50",children:[s.jsx(E,{className:"w-4 h-4 "+(t?"animate-spin":"")}),s.jsx("span",{children:h?"重新获取":"Retry"})]})]}),t&&s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[s.jsx(I,{className:"w-5 h-5 animate-spin"}),s.jsx("span",{children:h?"正在获取最新AI新闻...":"Loading latest AI news..."})]})}),!t&&!n&&s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map((e,t)=>s.jsx("div",{className:"animate-fade-in",style:{animationDelay:100*t+"ms"},children:s.jsx(le,{...e})},e.id))}),!t&&!n&&0===e.length&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:h?"暂无新闻":"No news available"}),s.jsx("p",{className:"text-muted-foreground",children:h?"请稍后再试，或切换其他分类查看":"Please try again later or switch to another category"})]})]})]})]})};export{xe as default};
