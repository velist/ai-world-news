import{j as e}from"./ui-core-ChrqsUrC-1758044137647.js";import{r as t}from"./react-vendor-BrSRjOqW-1758044137647.js";import{H as r}from"./index-Cttt-HEy-1758044137647.js";import{p as s}from"./personalSubscriptionShareService-CSC8Wb4n-1758044137647.js";import"./utils-DdJ5UvfL-1758044137647.js";import"./vendor-misc-DVwJBo1j-1758044137647.js";import"./query-oJX1HcLJ-1758044137647.js";import"./router-B1EXW9fX-1758044137647.js";import"./ui-extended-Czht78rK-1758044137647.js";const a=()=>{const[a,o]=t.useState([]),[i,c]=t.useState(!1),[l,d]=t.useState("https://wechat-debug-api.vee5208.workers.dev"),m=(e,t,r)=>{const s={type:e,timestamp:(new Date).toLocaleTimeString(),message:t,data:r};o(e=>[...e.slice(-49),s])},p=async()=>{try{const e=window.location.href,t=await fetch(`${l}/api/wechat/signature?url=${encodeURIComponent(e)}&debug=true`),r=await t.json();if(r.error)return void m("error","❌ 获取微信配置失败",r);const s=window.wx;m("info","🔧 配置微信JS-SDK...",{appId:r.appId,timestamp:r.timestamp,hasSignature:!!r.signature}),s.config({debug:!0,appId:r.appId,timestamp:r.timestamp,nonceStr:r.nonceStr,signature:r.signature,jsApiList:r.jsApiList}),s.ready(()=>{m("success","✅ 微信JS-SDK配置成功！可以使用分享功能")}),s.error(e=>{m("error","❌ 微信JS-SDK配置失败",e)})}catch(e){m("error","❌ 微信SDK测试失败",{error:e.message})}};return t.useEffect(()=>{m("info","🚀 微信分享调试页面已加载"),m("info","📱 用户代理",{userAgent:navigator.userAgent}),m("info","🌍 当前URL",{url:window.location.href}),m("info","📱 是否微信环境",{isWeChat:/micromessenger/i.test(navigator.userAgent)})},[]),e.jsxs(e.Fragment,{children:[e.jsxs(r,{children:[e.jsx("title",{children:"微信分享调试 - AI推测试站"}),e.jsx("meta",{name:"description",content:"微信分享功能调试和监控页面，用于测试个人订阅号的分享配置。"}),e.jsx("meta",{property:"og:title",content:"微信分享调试 - AI推测试站"}),e.jsx("meta",{property:"og:description",content:"微信分享功能调试和监控页面，用于测试个人订阅号的分享配置。"}),e.jsx("meta",{property:"og:image",content:"https://news.aipush.fun/wechat-share-300.png"}),e.jsx("meta",{property:"og:url",content:window.location.href})]}),e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"🔧 微信分享调试测试站"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Worker API地址:"}),e.jsx("input",{type:"text",value:l,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[e.jsx("button",{onClick:async()=>{c(!0),m("info","🔄 开始测试Worker API...");try{const e=await fetch(`${l}/api/wechat/status`),t=await e.json();m("success","✅ Worker状态检查成功",t);const r=window.location.href,s=await fetch(`${l}/api/wechat/signature?url=${encodeURIComponent(r)}&debug=true`),a=await s.json();a.error?m("error","❌ 签名生成失败",a):m("success","✅ 签名生成成功",{appId:a.appId,timestamp:a.timestamp,hasSignature:!!a.signature,signatureLength:a.signature?.length||0})}catch(e){m("error","❌ API测试失败",{error:e.message})}c(!1)},disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:i?"测试中...":"测试Worker API"}),e.jsx("button",{onClick:async()=>{if(m("info","🔄 测试微信JS-SDK..."),void 0===window.wx){m("warning","⚠️ 微信JS-SDK未加载，正在加载...");const e=document.createElement("script");e.src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js",e.onload=()=>{m("success","✅ 微信JS-SDK加载完成"),p()},e.onerror=()=>{m("error","❌ 微信JS-SDK加载失败")},document.head.appendChild(e)}else p()},className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"测试微信JS-SDK"}),e.jsx("button",{onClick:()=>{m("info","🔄 测试Meta标签分享方案...");const e={title:"微信分享测试 - AI推",desc:"这是一个微信分享功能的测试页面，用于验证个人订阅号的分享配置。",link:window.location.href,imgUrl:"https://news.aipush.fun/wechat-share-300.png"};try{s.configureShare(e),m("success","✅ Meta标签分享配置完成",e);const t={};document.querySelectorAll('meta[property^="og:"], meta[name^="twitter:"]').forEach(e=>{const r=e.getAttribute("property")||e.getAttribute("name"),s=e.getAttribute("content");r&&s&&(t[r]=s)}),m("info","📋 当前页面Meta标签",t)}catch(t){m("error","❌ Meta标签配置失败",{error:t.message})}},className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700",children:"测试Meta标签分享"}),e.jsx("button",{onClick:async()=>{try{const e=await fetch(`${l}/debug/logs?limit=10`),t=await e.json();m("info","📋 Worker调试日志",t)}catch(e){m("error","❌ 加载Worker日志失败",{error:e.message})}},className:"px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700",children:"查看Worker日志"}),e.jsx("button",{onClick:()=>{o([]),m("info","🗑️ 本地日志已清除")},className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"清除日志"})]}),e.jsxs("div",{className:"bg-gray-900 text-gray-100 rounded-lg p-4 h-96 overflow-y-auto font-mono text-sm",children:[e.jsxs("div",{className:"mb-2 text-gray-400",children:["=== 调试日志 (最近",a.length,"条) ==="]}),a.map((t,r)=>e.jsxs("div",{className:`mb-1 ${n(t.type)}`,children:[e.jsxs("span",{className:"text-gray-400",children:["[",t.timestamp,"]"]})," ",e.jsx("span",{className:"text-white",children:t.message}),t.data&&e.jsx("div",{className:"mt-1 ml-4 text-gray-300 whitespace-pre-wrap",children:"string"==typeof t.data?t.data:JSON.stringify(t.data,null,2)})]},r)),0===a.length&&e.jsx("div",{className:"text-gray-400",children:"暂无日志记录..."})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"📖 使用说明:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• 在微信中打开此页面进行测试"}),e.jsx("li",{children:"• 点击各种测试按钮查看详细的调试信息"}),e.jsx("li",{children:"• Worker日志会记录所有API调用和响应"}),e.jsx("li",{children:"• 分享时查看控制台和日志了解详细过程"})]})]})]})})})]})};function n(e){switch(e){case"error":return"text-red-400";case"success":return"text-green-400";case"warning":return"text-yellow-400";case"info":return"text-blue-400";default:return"text-gray-300"}}export{a as WeChatDebugPage};
