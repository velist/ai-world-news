# 0917 修复记录

## 概览
- 完成搜索页与收藏页落地，统一分类过滤逻辑；优化新闻数据获取与呈现；更新站点地图与 SEO 脚本；完成本地构建验证。

## 主要改动
- 搜索页（新增）：`src/pages/SearchPage.tsx`
  - 支持搜索历史、热门词；相关性/时间排序；移动端底部导航。
  - 关键修复：分类过滤与首页逻辑一致，使用 `useNewsTranslation.getLocalizedCategory` 进行比较，避免中英文或别名导致的过滤失效。

- 收藏页（新增）：`src/pages/BookmarksPage.tsx`
  - 基于 `localStorage` 管理收藏列表，支持移除与清空；支持在收藏内搜索。

- 导航与装配：
  - `src/App.tsx`：接入路由（`/search`、`/bookmarks` 等），微信环境使用 `HashRouter`，初始化 URL 规范化与错误边界。
  - `src/components/MobileNavigation.tsx`：新增首页/搜索/收藏/菜单底部导航，支持滚动隐藏与安全区占位，附带新手手势提示组件。

- 新闻数据与呈现：
  - `src/hooks/useNews.ts`：
    - 加入 5 分钟缓存与 2 秒请求限流；强制刷新时带时间戳避免缓存；失败回退到缓存；统一以 `publishedAt` 降序排序。
    - 语言切换时做轻量防抖再处理，减少滚动抖动；保留原始数据与本地化后的视图数据。
  - `src/components/NewsCard.tsx`：
    - 收藏按钮与 `localStorage` 状态同步；微信分享引导；图片跨域代理与 SVG 智能回退；分类样式和相对时间显示优化。

- SEO 与站点地图：
  - 生成并更新：`public/sitemap.xml`、`public/sitemap-index.xml`。
  - `scripts/seo-service.cjs`：提供生成 sitemap、提交到搜索引擎（Baidu/Google/Bing）的工作流；本地环境下 Google/Bing ping 失败属预期（网络/权限限制）；Baidu 推送需配置 `BAIDU_PUSH_TOKEN`。
  - 新增辅助脚本：`scripts/generate-test-blog.cjs`、`scripts/test-blog-generation.cjs`。

## 构建验证
- 在 `ai-world-news` 目录执行 `npm run build`，产物生成正常，动态路由页面（搜索/收藏）按 chunk 输出，构建通过。

## 未完成 / 后续建议
1. Git 提交与部署：
   - 子模块 `ai-world-news` 已完成本地提交；远端 `main` 有新提交，推送被拒，需要先同步后再推送：
     - `git pull --rebase`（或解决冲突后继续），然后 `git push origin main`。
   - 根仓库如含子模块指针，请在根仓库更新子模块引用后提交并推送。
   - 部署：可尝试 `npm run deploy`、`npm run deploy:quick` 或按现有部署脚本文档执行。
2. SEO 配置：
   - 在部署环境配置 `BAIDU_PUSH_TOKEN`、`BING_API_KEY`、（可选）`GOOGLE_API_KEY`。
   - 运行 `node scripts/seo-service.cjs` 或 `npm run generate-sitemap` 确认 sitemap 最新。
3. 页面索引策略：
   - 建议为 `/search` 与 `/bookmarks` 添加 `<meta name="robots" content="noindex,follow">`，避免索引质量问题。
4. 产物与临时文件：
   - 评估是否忽略或清理 `public/blog-data-test.json`、`public/blog-data.json.backup`。
5. 跨平台换行与编码：
   - Windows 环境可能出现 CRLF/LF 提示，可统一设置 `.gitattributes` 或本地 `core.autocrlf`。

## 变更文件摘要（子模块 ai-world-news）
- 新增：
  - `src/pages/SearchPage.tsx`
  - `src/pages/BookmarksPage.tsx`
  - `public/sitemap-index.xml`
  - `scripts/generate-test-blog.cjs`
  - `scripts/test-blog-generation.cjs`
- 修改：
  - `src/App.tsx`
  - `src/components/MobileNavigation.tsx`
  - `src/components/NewsCard.tsx`
  - `src/hooks/useNews.ts`
  - `public/sitemap.xml`
  - `scripts/auto-blog-generator.cjs`

—— 本次改动重点解决“搜索分类过滤不一致”和“移动端导航与交互完整性”，并对数据抓取与 SEO 输出做了工程化增强。

