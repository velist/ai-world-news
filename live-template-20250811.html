<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«‹å³ç”Ÿæ•ˆæ¨¡æ¿ç”Ÿæˆå™¨</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .preview-area {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }
        .form-section {
            flex: 1;
            min-width: 350px;
        }
        .preview-section {
            flex: 1;
            text-align: center;
        }
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        textarea {
            height: 120px;
            resize: vertical;
            font-family: inherit;
        }
        button {
            background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
        }
        .share-preview {
            max-width: 100%;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }
        .success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            background: linear-gradient(135deg, #cce7ff 0%, #b3d9ff 100%);
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 32px;
            font-weight: 700;
        }
        .form-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 15px;
        }
        .feature-badge {
            display: inline-block;
            background: linear-gradient(135deg, #00FF00 0%, #32CD32 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ ç«‹å³ç”Ÿæ•ˆæ¨¡æ¿ç”Ÿæˆå™¨<span class="feature-badge">LIVE</span></h1>
    
    <div class="test-container">
        <div class="preview-area">
            <div class="form-section">
                <div class="form-group">
                    <label>ğŸ·ï¸ æ–°é—»æ ‡é¢˜</label>
                    <textarea id="titleInput" placeholder="è¾“å…¥æ–°é—»æ ‡é¢˜...">OpenAIå‘å¸ƒGPT-5ï¼šæ€§èƒ½é£è·ƒå¼æå‡ï¼Œå¤šæ¨¡æ€èƒ½åŠ›å…¨é¢å¢å¼º</textarea>
                </div>
                
                <div class="form-group">
                    <label>ğŸ“ æ–°é—»å†…å®¹</label>
                    <textarea id="contentInput" placeholder="è¾“å…¥æ–°é—»å†…å®¹...">OpenAIä»Šæ—¥æ­£å¼å‘å¸ƒäº†å¤‡å—æœŸå¾…çš„GPT-5æ¨¡å‹ï¼Œè¿™ä¸€é‡Œç¨‹ç¢‘å¼çš„æ›´æ–°å¸¦æ¥äº†å‰æ‰€æœªæœ‰çš„æ€§èƒ½æå‡ã€‚æ–°æ¨¡å‹åœ¨è‡ªç„¶è¯­è¨€ç†è§£ã€æ¨ç†èƒ½åŠ›å’Œå¤šæ¨¡æ€å¤„ç†æ–¹é¢éƒ½æœ‰æ˜¾è‘—è¿›æ­¥ï¼Œå¤„ç†é€Ÿåº¦æå‡30%ï¼Œå‡†ç¡®æ€§å¤§å¹…å¢å¼ºã€‚GPT-5æ”¯æŒæ›´é•¿çš„ä¸Šä¸‹æ–‡é•¿åº¦ï¼Œèƒ½å¤Ÿå¤„ç†å¤æ‚çš„å¤šè½®å¯¹è¯ï¼Œåœ¨ç¼–ç¨‹ã€æ•°å­¦ã€ç§‘å­¦ç ”ç©¶ç­‰ä¸“ä¸šé¢†åŸŸè¡¨ç°å°¤ä¸ºçªå‡ºã€‚</textarea>
                </div>
                
                <button onclick="generateLiveTemplate()" id="generateBtn">
                    âš¡ ç«‹å³ç”Ÿæ•ˆ - ç”Ÿæˆæ¨¡æ¿åˆ†äº«å›¾
                </button>
                
                <div id="status"></div>
            </div>
            
            <div class="preview-section">
                <h3 style="color: #333; margin-bottom: 20px;">ğŸ–¼ï¸ åˆ†äº«å›¾é¢„è§ˆ</h3>
                <div id="sharePreview">
                    <p style="color: #999; padding: 60px 20px; background: #f8f9fa; border-radius: 12px; border: 2px dashed #dee2e6;">
                        ç‚¹å‡»ç”ŸæˆæŒ‰é’®æŸ¥çœ‹ç«‹å³ç”Ÿæ•ˆæ•ˆæœ
                    </p>
                </div>
                <button onclick="downloadShare()" id="downloadBtn" style="margin-top: 20px; display: none;">
                    ğŸ’¾ ä¸‹è½½åˆ†äº«å›¾
                </button>
            </div>
        </div>
    </div>

    <script>
        console.log('âš¡ ç«‹å³ç”Ÿæ•ˆæ¨¡æ¿ç”Ÿæˆå™¨å·²åŠ è½½ - æ—¶é—´æˆ³: ' + new Date().toISOString());
        
        let currentShareData = null;

        // ç«‹å³ç”Ÿæ•ˆæ¨¡æ¿åˆ†äº«å›¾æœåŠ¡
        class LiveTemplateService {
            constructor() {
                this.canvas = document.createElement('canvas');
                this.ctx = this.canvas.getContext('2d');
                
                this.canvas.width = 800;
                this.canvas.height = 1200;
                
                console.log('âš¡ ç«‹å³ç”Ÿæ•ˆæ¨¡æ¿æœåŠ¡åˆå§‹åŒ–å®Œæˆï¼ŒCanvaså°ºå¯¸: 800x1200');
            }

            async generateShareImage(newsData) {
                console.log('ğŸš€ å¼€å§‹ç”Ÿæˆç«‹å³ç”Ÿæ•ˆæ¨¡æ¿åˆ†äº«å›¾...');
                console.log(`ğŸ“‹ æ•°æ®: æ ‡é¢˜="${newsData.title}"ï¼Œå†…å®¹="${newsData.content.substring(0, 50)}..."`);
                
                try {
                    // æ­¥éª¤1: åŠ è½½çœŸå®æ¨¡æ¿å›¾ç‰‡ä½œä¸ºèƒŒæ™¯
                    console.log('ğŸ“¸ æ­¥éª¤1: åŠ è½½çœŸå®æ¨¡æ¿å›¾ç‰‡èƒŒæ™¯');
                    await this.loadTemplateBackground();
                    
                    // æ­¥éª¤2: åœ¨è“è‰²æ ‡é¢˜åŒºåŸŸå åŠ æ ‡é¢˜
                    console.log('ğŸ·ï¸ æ­¥éª¤2: å åŠ æ ‡é¢˜æ–‡å­—');
                    this.overlayTitleText(newsData.title);
                    
                    // æ­¥éª¤3: åœ¨ç™½è‰²å†…å®¹åŒºåŸŸå åŠ å†…å®¹
                    console.log('ğŸ“ æ­¥éª¤3: å åŠ å†…å®¹æ–‡å­—');
                    this.overlayContentText(newsData.content);
                    
                    // æ­¥éª¤4: ç”Ÿæˆå¹¶å åŠ äºŒç»´ç 
                    console.log('ğŸ”² æ­¥éª¤4: ç”Ÿæˆå¹¶å åŠ äºŒç»´ç ');
                    await this.overlayQRCode(newsData.id);
                    
                    const result = this.canvas.toDataURL('image/jpeg', 0.92);
                    console.log('âœ… ç«‹å³ç”Ÿæ•ˆæ¨¡æ¿åˆ†äº«å›¾ç”Ÿæˆå®Œæˆï¼');
                    
                    return result;
                    
                } catch (error) {
                    console.error(`âŒ ç”Ÿæˆå¤±è´¥: ${error.message}`);
                    throw error;
                }
            }

            async loadTemplateBackground() {
                // å°è¯•åŠ è½½æ¨¡æ¿å›¾ç‰‡çš„å¤šä¸ªå¯èƒ½è·¯å¾„
                const templatePaths = [
                    './æ–°é—»å›¾åˆ†äº«ç¤ºæ„-ç©ºç™½.jpg',
                    './share-template-blank.jpg', 
                    '../æ–°é—»å›¾åˆ†äº«ç¤ºæ„-ç©ºç™½.jpg'
                ];
                
                for (const path of templatePaths) {
                    try {
                        console.log(`ğŸ” å°è¯•åŠ è½½æ¨¡æ¿: ${path}`);
                        const templateImg = await this.loadImageWithTimeout(path, 8000);
                        
                        // æˆåŠŸåŠ è½½ï¼Œç»˜åˆ¶åˆ°Canvas
                        this.ctx.drawImage(templateImg, 0, 0, 800, 1200);
                        console.log(`âœ… æ¨¡æ¿åŠ è½½æˆåŠŸ: ${path}ï¼Œå°ºå¯¸: ${templateImg.width}x${templateImg.height}`);
                        return;
                        
                    } catch (error) {
                        console.log(`âš ï¸ æ¨¡æ¿è·¯å¾„å¤±è´¥: ${path} - ${error.message}`);
                        continue;
                    }
                }
                
                // æ‰€æœ‰è·¯å¾„éƒ½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨è“è‰²æ¸å˜èƒŒæ™¯
                console.warn('âŒ æ— æ³•åŠ è½½ä»»ä½•æ¨¡æ¿å›¾ç‰‡ï¼Œä½¿ç”¨å¤‡ç”¨èƒŒæ™¯');
                this.drawFallbackBackground();
            }
            
            drawFallbackBackground() {
                console.log('ğŸ”„ ä½¿ç”¨å¤‡ç”¨è“è‰²æ¸å˜èƒŒæ™¯');
                const gradient = this.ctx.createLinearGradient(0, 0, 0, this.canvas.height);
                gradient.addColorStop(0, '#4A90E2');
                gradient.addColorStop(0.5, '#357ABD');
                gradient.addColorStop(1, '#7FB3D3');
                
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ç»˜åˆ¶ç™½è‰²å†…å®¹å¡ç‰‡
                this.ctx.fillStyle = '#ffffff';
                this.ctx.fillRect(80, 240, 640, 480);
                
                // ç»˜åˆ¶åº•éƒ¨ç°è‰²äºŒç»´ç å ä½ç¬¦
                this.ctx.fillStyle = '#cccccc';
                this.ctx.fillRect(105, 1038, 170, 170);
                this.ctx.fillStyle = '#999999';
                this.ctx.font = '18px Microsoft YaHei';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('äºŒç»´ç ', 190, 1128);
            }

            overlayTitleText(title) {
                console.log('ğŸ¨ å¼€å§‹ç»˜åˆ¶æ ‡é¢˜æ–‡å­— - å®Œå…¨åŒ¹é…åŸå§‹æ¨¡æ¿');
                
                this.ctx.fillStyle = '#ffffff';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                
                // åŸºäºåŸå§‹æ¨¡æ¿"æ ‡é¢˜å†…å®¹"çš„ç²¾ç¡®ä½ç½®
                const titleY = 130;
                
                // æ™ºèƒ½å­—ä½“å¤§å°ï¼šæ ¹æ®æ ‡é¢˜é•¿åº¦è°ƒæ•´
                let fontSize = 48;
                if (title.length > 30) fontSize = 36;
                else if (title.length > 20) fontSize = 42;
                
                this.ctx.font = `bold ${fontSize}px "Microsoft YaHei", "PingFang SC", sans-serif`;
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ†è¡Œ - åŸºäºåƒç´ å®½åº¦è€Œéå­—ç¬¦æ•°
                const maxWidth = 640; // è“è‰²åŒºåŸŸå¯ç”¨å®½åº¦
                const titleWidth = this.ctx.measureText(title).width;
                
                if (titleWidth > maxWidth) {
                    // æ™ºèƒ½åˆ†è¡Œï¼šä¼˜å…ˆåœ¨æ ‡ç‚¹å¤„åˆ†è¡Œ
                    let splitIndex = title.indexOf('ï¼š');
                    if (splitIndex === -1 || splitIndex > title.length * 0.7) {
                        splitIndex = Math.floor(title.length / 2);
                    } else {
                        splitIndex += 1; // å†’å·ååˆ†è¡Œ
                    }
                    
                    const line1 = title.substring(0, splitIndex).trim();
                    const line2 = title.substring(splitIndex).trim();
                    
                    // å†æ¬¡æ£€æŸ¥åˆ†è¡Œåçš„å®½åº¦
                    const line1Width = this.ctx.measureText(line1).width;
                    const line2Width = this.ctx.measureText(line2).width;
                    
                    if (line1Width > maxWidth || line2Width > maxWidth) {
                        fontSize = Math.max(32, fontSize - 6);
                        this.ctx.font = `bold ${fontSize}px "Microsoft YaHei", "PingFang SC", sans-serif`;
                    }
                    
                    // ç»˜åˆ¶ä¸¤è¡Œæ ‡é¢˜
                    this.ctx.fillText(line1, 400, titleY - 25);
                    this.ctx.fillText(line2, 400, titleY + 25);
                    console.log(`ğŸ“ åŒè¡Œæ ‡é¢˜(${fontSize}px): "${line1}" | "${line2}"`);
                } else {
                    // å•è¡Œæ ‡é¢˜
                    this.ctx.fillText(title, 400, titleY);
                    console.log(`ğŸ“ å•è¡Œæ ‡é¢˜(${fontSize}px): "${title}"`);
                }
            }
            
            findBestSplitPoint(title, maxWidth) {
                // å¯»æ‰¾æœ€ä½³åˆ†å‰²ç‚¹ï¼Œç¡®ä¿ä¸¤è¡Œéƒ½ä¸è¶…å®½
                let bestSplit = Math.floor(title.length / 2);
                
                for (let i = Math.floor(title.length * 0.4); i <= Math.floor(title.length * 0.6); i++) {
                    const line1 = title.substring(0, i);
                    const line2 = title.substring(i);
                    
                    const line1Width = this.ctx.measureText(line1).width;
                    const line2Width = this.ctx.measureText(line2).width;
                    
                    if (line1Width <= maxWidth && line2Width <= maxWidth) {
                        bestSplit = i;
                        break;
                    }
                }
                
                return bestSplit;
            }

            overlayContentText(content) {
                console.log('ğŸ“„ å¼€å§‹ç»˜åˆ¶å†…å®¹æ–‡å­— - 36pxå¤§å­—ä½“');
                
                this.ctx.fillStyle = '#333333';
                this.ctx.font = '36px "Microsoft YaHei", "PingFang SC", sans-serif';
                this.ctx.textAlign = 'left';
                this.ctx.textBaseline = 'top';
                
                // ç²¾ç¡®å®šä½å†…å®¹åŒºåŸŸï¼šç™½è‰²å¡ç‰‡å†…
                const contentX = 120;
                const contentY = 280;
                const maxWidth = 560;
                const lineHeight = 48;
                
                // é™åˆ¶å†…å®¹é•¿åº¦
                const maxContentLength = 160;
                let displayContent = content;
                if (content.length > maxContentLength) {
                    displayContent = content.substring(0, maxContentLength) + '...';
                }
                
                // æ–‡å­—è‡ªåŠ¨æ¢è¡Œ
                const lines = this.wrapText(displayContent, maxWidth);
                console.log(`ğŸ“ å†…å®¹åˆ†ä¸º ${lines.length} è¡Œæ˜¾ç¤º`);
                
                // ç»˜åˆ¶æ¯ä¸€è¡Œ
                lines.slice(0, 8).forEach((line, index) => {
                    const y = contentY + (index * lineHeight);
                    this.ctx.fillText(line, contentX, y);
                });
            }

            async overlayQRCode(newsId) {
                console.log('ğŸ”² å¼€å§‹ç”ŸæˆäºŒç»´ç  - ç²¾ç¡®æ›¿æ¢åŸå§‹æ¨¡æ¿ç°è‰²å ä½ç¬¦');
                
                // åŸºäºåŸå§‹æ¨¡æ¿ä¸­ç°è‰²"äºŒç»´ç "å ä½ç¬¦çš„ç²¾ç¡®ä½ç½®
                const qrSize = 170;      // å®Œå…¨è¦†ç›–ç°è‰²å ä½ç¬¦
                const qrX = 105;         // ç°è‰²å ä½ç¬¦çš„å·¦ä¸Šè§’X
                const qrY = 1038;        // ç°è‰²å ä½ç¬¦çš„å·¦ä¸Šè§’Y
                
                const newsUrl = `https://news.aipush.fun/#/news/${newsId}`;
                console.log(`ğŸ”— äºŒç»´ç URL: ${newsUrl}`);
                console.log(`ğŸ“ äºŒç»´ç ç²¾ç¡®ä½ç½®: (${qrX}, ${qrY})ï¼Œå°ºå¯¸: ${qrSize}x${qrSize}`);
                console.log(`ğŸ¯ å®šä½ç­–ç•¥: å·¦ä¸‹è§’æ”¾ç½®ï¼Œé¿å¼€å³ä¸‹è§’å°çŒ«å“ç‰Œæ ‡è¯†`);
                
                const qrApis = [
                    `https://api.qrserver.com/v1/create-qr-code/?size=${qrSize}x${qrSize}&data=${encodeURIComponent(newsUrl)}&format=png&margin=0&ecc=H&color=000000&bgcolor=ffffff`,
                    `https://quickchart.io/qr?text=${encodeURIComponent(newsUrl)}&size=${qrSize}&format=png&ecLevel=H&margin=0&dark=000000&light=ffffff`
                ];
                
                for (const apiUrl of qrApis) {
                    try {
                        console.log(`ğŸŒ å°è¯•äºŒç»´ç API: ${apiUrl.split('?')[0]}`);
                        const qrImg = await this.loadImageWithTimeout(apiUrl, 6000);
                        
                        // ç²¾ç¡®ç»˜åˆ¶åˆ°å·¦ä¸‹è§’ä½ç½®
                        this.ctx.drawImage(qrImg, qrX, qrY, qrSize, qrSize);
                        console.log(`âœ… äºŒç»´ç ç²¾ç¡®å®šä½æˆåŠŸï¼Œå®Œç¾é¿å¼€å“ç‰Œæ ‡è¯†`);
                        return;
                        
                    } catch (error) {
                        console.log(`âš ï¸ äºŒç»´ç APIå¤±è´¥: ${error.message}`);
                        continue;
                    }
                }
                
                console.log('âš ï¸ æ‰€æœ‰äºŒç»´ç APIéƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºå ä½ç¬¦');
                this.ctx.fillStyle = '#cccccc';
                this.ctx.fillRect(qrX, qrY, qrSize, qrSize);
                this.ctx.fillStyle = '#666666';
                this.ctx.font = 'bold 16px "Microsoft YaHei"';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('äºŒç»´ç ', qrX + qrSize/2, qrY + qrSize/2);
            }

            wrapText(text, maxWidth) {
                const lines = [];
                let currentLine = '';
                
                for (let i = 0; i < text.length; i++) {
                    const testLine = currentLine + text[i];
                    const metrics = this.ctx.measureText(testLine);
                    
                    if (metrics.width > maxWidth && currentLine !== '') {
                        lines.push(currentLine);
                        currentLine = text[i];
                    } else {
                        currentLine = testLine;
                    }
                }
                
                if (currentLine) {
                    lines.push(currentLine);
                }
                
                return lines;
            }

            loadImageWithTimeout(src, timeout = 8000) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    
                    const timer = setTimeout(() => {
                        reject(new Error(`å›¾ç‰‡åŠ è½½è¶…æ—¶: ${src}`));
                    }, timeout);
                    
                    img.onload = () => {
                        clearTimeout(timer);
                        resolve(img);
                    };
                    
                    img.onerror = () => {
                        clearTimeout(timer);
                        reject(new Error(`å›¾ç‰‡åŠ è½½å¤±è´¥: ${src}`));
                    };
                    
                    img.src = src;
                });
            }
        }

        const liveTemplateService = new LiveTemplateService();

        async function generateLiveTemplate() {
            console.log('âš¡ ç”Ÿæˆç«‹å³ç”Ÿæ•ˆæ¨¡æ¿åˆ†äº«å›¾å¼€å§‹');
            const generateBtn = document.getElementById('generateBtn');
            const status = document.getElementById('status');
            const preview = document.getElementById('sharePreview');
            const downloadBtn = document.getElementById('downloadBtn');
            
            if (generateBtn.disabled) return;
            
            generateBtn.disabled = true;
            generateBtn.textContent = 'ğŸ”„ ç”Ÿæˆä¸­...';
            status.innerHTML = '<div class="loading">â³ æ­£åœ¨ç”Ÿæˆç«‹å³ç”Ÿæ•ˆæ¨¡æ¿åˆ†äº«å›¾ï¼Œè¯·ç¨å€™...</div>';
            
            try {
                const newsData = {
                    id: `news_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    title: document.getElementById('titleInput').value || 'é»˜è®¤æ–°é—»æ ‡é¢˜',
                    content: document.getElementById('contentInput').value || 'é»˜è®¤æ–°é—»å†…å®¹'
                };
                
                console.log('ğŸ“‹ æ–°é—»æ•°æ®:', newsData);
                const imageResult = await liveTemplateService.generateShareImage(newsData);
                currentShareData = { imageResult, newsData };
                
                preview.innerHTML = `<img src="${imageResult}" class="share-preview" alt="ç«‹å³ç”Ÿæ•ˆæ¨¡æ¿åˆ†äº«å›¾" />`;
                status.innerHTML = '<div class="success">âœ… ç«‹å³ç”Ÿæ•ˆæ¨¡æ¿åˆ†äº«å›¾ç”ŸæˆæˆåŠŸï¼å®Œç¾åŒ¹é…æ‚¨çš„æœŸæœ›æ•ˆæœ</div>';
                downloadBtn.style.display = 'block';
                console.log('âœ… ç«‹å³ç”Ÿæ•ˆæ¨¡æ¿åˆ†äº«å›¾ç”Ÿæˆå®Œæˆ');
                
            } catch (error) {
                console.error('âŒ ç”Ÿæˆè¿‡ç¨‹å‡ºé”™:', error);
                status.innerHTML = '<div class="error">âŒ ç”Ÿæˆå¤±è´¥ï¼š' + error.message + '</div>';
                preview.innerHTML = '<p style="color: #999; padding: 60px 20px; background: #f8f9fa; border-radius: 12px; border: 2px dashed #dee2e6;">ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•</p>';
                downloadBtn.style.display = 'none';
            }
            
            generateBtn.disabled = false;
            generateBtn.textContent = 'âš¡ ç«‹å³ç”Ÿæ•ˆ - ç”Ÿæˆæ¨¡æ¿åˆ†äº«å›¾';
        }

        function downloadShare() {
            if (!currentShareData) return;
            
            const link = document.createElement('a');
            link.download = `AIæ¨ç«‹å³ç”Ÿæ•ˆåˆ†äº«å›¾_${new Date().getTime()}.jpg`;
            link.href = currentShareData.imageResult;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>